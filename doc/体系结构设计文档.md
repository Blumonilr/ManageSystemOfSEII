```Java

# 灯厂进销存系统软件体系结构设计文档

## 目录
#### 1.引言
    1.1 编制目的
    1.2 词汇表
    1.3 参考资料
    1.4 更新历史
#### 2.产品概述
#### 3.逻辑视角
#### 4.组合视角
    4.1 开发包图
    4.2 运行时进程
#### 5.接口视角
    5.1 模块职责
    5.2 用户层界面的分解
       5.2.1 用户界面层模块的职责
       5.2.2 用户界面层模块的接口规范
       5.2.3 用户界面模块设计原理
    5.3 业务逻辑层的分解
       5.3.1 业务逻辑层模块的职责
       5.3.2 业务逻辑层模块的接口规范
            5.3.2.1 stockbl接口规范
                   5.3.2.1.1 供接口
                   5.3.2.1.2 需接口
            5.3.2.2 clientbl接口规范
                   5.3.2.2.1 供接口
                   5.3.2.2.2 需接口
            5.3.2.3 purchasebl接口规范
                   5.3.2.3.1 供接口
                   5.3.2.3.2 需接口
            5.3.2.4 salebl接口规范
                   5.3.2.4.1 供接口
                   5.3.2.4.2 需接口
            5.3.2.5 accountbl接口规范
                   5.3.2.5.1 供接口
                   5.3.2.5.2 需接口
            5.3.2.6 financebl接口规范
                   5.3.2.6.1 供接口
                   5.3.2.6.2 需接口
            5.3.2.7 formbl接口规范
                   5.3.2.7.1 供接口
                   5.3.2.7.2 需接口
            5.3.2.8 bookbl接口规范
                   5.3.2.8.1 供接口
                   5.3.2.8.2 需接口
            5.3.2.9 revisebl接口规范
                   5.3.2.9.1 供接口
                   5.3.2.9.2 需接口
            5.3.2.10 strategybl接口规范
                   5.3.2.10.1 供接口
                   5.3.2.10.2 需接口
            5.3.2.11 userbl接口规范
                   5.3.2.11.1 供接口
                   5.3.2.11.2 需接口
            5.3.2.12 logbl接口规范
                   5.3.2.12.1 供接口
                   5.3.2.12.2 需接口
            5.3.2.13 chatbl接口规范
                   5.3.2.13.1 供接口
                   5.3.2.13.2 需接口
      5.4 数据层的分解
        5.4.1 stockdata模块
            5.4.1.1 数据层模块的职责
            5.4.1.2 数据层模块的接口规范
        5.4.2 clientdata模块
            5.4.2.1 数据层模块的职责
            5.4.2.2 数据层模块的接口规范       
        5.4.3 accountdata模块
            5.4.3.1 数据层模块的职责
            5.43.2 数据层模块的接口规范
        5.4.4 bookdata模块
            5.4.4.1 数据层模块的职责
            5.4.4.2 数据层模块的接口规范
        5.4.5 revisedata模块
            5.4.5.1 数据层模块的职责
            5.4.5.2 数据层模块的接口规范
        5.4.6 strategydata模块
            5.4.6.1 数据层模块的职责
            5.4.6.2 数据层模块的接口规范       
        5.4.7 userdata模块
            5.4.7.1 数据层模块的职责
            5.4.7.2 数据层模块的接口规范
        5.4.8 logdata模块
            5.4.8.1 数据层模块的职责
            5.4.8.2 数据层模块的接口规范
        5.4.9 chatdata模块
            5.4.9.1 数据层模块的职责
            5.4.9.2 数据层模块的接口规范
  #### 6.信息视角
      6.1 数据化持久对象
      6.2 Txt持久化格式

## 1.引言
### 1.1 编制目的
本报告详细完成对灯厂进销存系统的概要设计，达到指导详细设计和开发的目的，同时实现和测试人员及用户的沟通。
本报告面向开发人员、测试人员及最终用户而编写，是了解系统的导航。
### 1.2 词汇表
ui	表示某展示层  
bl	表示某逻辑层  
data	表示某数据层  
RMI	表示远程方法调用  
utility_bl	表示初始化和业务逻辑上下文的工作  
### 1.3 参考资料
1.IEEE std 1471-2000  
2.丁二玉，刘钦.计算与软件工程（卷二）[M]机械工业出版2012：134—182
### 1.4 更新历史
| **修改人员**                   | **日期**  | **变更原因**   | **版本号**  |
|--------------------------------|-----------|----------------|-------------|
| 钱宇辰、靳炳淑、王一博、吴林漾 | 2017-10-09 | 创建新文件       | V0.0   |
| 钱宇辰、靳炳淑、王一博、吴林漾 | 2017-10-15 | 添加开发包| V1.0 |
| 钱宇辰、靳炳淑、王一博、吴林漾 | 2017-10-17 | 添加部分业务层接口规范和数据层接口规范 | V1.1 |
| 钱宇辰、靳炳淑、王一博、吴林漾 |2017-10-20 | 添加界面跳转说明 | V1.2 |
| 钱宇辰、靳炳淑、王一博、吴林漾 |2017-10-21 | 添加业务层接口规范和数据层接口规范 | V1.3 |
| 钱宇辰、靳炳淑、王一博、吴林漾 |2017-10-22 | 修改业务层接口规范和数据层接口规范 | V1.4 |
| 钱宇辰、靳炳淑、王一博、吴林漾 |2017-10-23 | 初步完成体系结构设计文档 | V1.4 |
| 王一博、吴林漾 |2017-10-30 | 修改业务层接口规范和数据层接口规范 | V1.5 |
| 钱宇辰、靳炳淑、王一博、吴林漾 |2017-11-07 | 补回文档丢失部分 | V1.6 |
| 钱宇辰、靳炳淑、王一博、吴林漾 |2018-01-08 | 最后修改文档并补全 | V2.0 |

## 2.产品概述
参考灯厂进销存系统用例文档和灯厂进销存系统软件规格需求说明中对产品的概括描述以及系统用例图。

## 3.逻辑视角
灯厂进销存系统中，选择了分层体系结构风格，将系统分为3层(展示层、业务逻辑层、数据层)能够很好地示意整个高层抽象。展示层包含GUI页面的实现，业务逻辑层包含业务逻辑处理的实现，数据层负责数据的持久化和访问。分层体系结构的逻辑视角和逻辑设计方案如图一和图二所示

图一
![逻辑视角](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/%E9%80%BB%E8%BE%91%E8%A7%86%E8%A7%92.png)

图二
![体系结构设计逻辑模型](http://101.37.19.32:10080/161250103/ManageSystem/raw/wulinyang/doc/graph/%E9%80%BB%E8%BE%91%E8%A7%86%E8%A7%922.png)






## 4.组合视角

### 4.1 开发包图

灯具厂进销存系统的最终开发包图设计如下表所示。

|物理包|依赖包|
|---|---|
|mainui|stockblui,clientui,purchaseui,saleui,accountui,financeui,userui,strategyui,formui,bookui,reviseui|
|stockui|stockblservice,vo|
|stockblservice|RMI,vo|
|stockbl|stockblservice,stockdataservice,salebl,purchasebl,revisebl,po,vo|
|stockdataservice|po|
|stockdata|stockdataservice,datatool,po|
|clientui|clientblservice,vo|
|clientblservice|RMI,vo|
|clientbl|clientblservice,clientdataservice,purchasebl,salebl,po,vo|
|clientdataservice|po|
|clientdata|clientdataservice,datatool,po|
|purchaseui|purchaseblservice,vo|
|purchaseblservice|RMI,vo|
|purchasebl|purchaseblservice,stockbl,clientbl,financebl,salebl,po,vo|
|saleui|saleblservice,vo|
|saleblservice|RMI,vo|
|salebl|saleblservice,strategybl,stockbl,clientbl,financebl,formbl,revisebl,po,vo|
|accountui|accountblservice,vo|
|accountblservice|RMI,vo|
|accountbl|accountblservice,accountdataservice,financebl,userbl,po,vo|
|accountdataservice|po|
|accountdata|accountdataservice,datatool,po|
|financeui|financeblservice,vo|
|financeblservice|RMI,vo|
|financebl|financeblservice,clientbl,userbl,accountbl,rrevisebl,po,vo|
|formui|formblservice,vo|
|formblservice|RMI,vo|
|formbl|formblservice,clientbl,stockbl,financebl,salebl,po,vo|
|bookui|bookblservice,vo|
|bookblservice|RMI,vo|
|bookbl|bookblservice,bookdataservice,stockbl,clientbl,accountbl,financebl,po,vo|
|bookdataservice|po|
|bookdata|bookdataservice,datatool,po|
|reviseui|reviseblservice,vo|
|reviseblservice|RMI,vo|
|revisebl|reviseblservice,revisedataservice,stockbl,purchasebl,salebl,financebl,strategybl,po,vo|
|revisedataservise|po|
|revisedata|revisedataservice,datatool,po|
|strategyui|strategyblservice,vo|
|strategyblservice|RMI,vo|
|strategybl|strategyblservice,strategydataservice,stockbl,po,vo|
|strategydataservice|po|
|strategydata|strategydataservice,datatool,po|
|userui|userblservice,vo|
|userblservice|RMI,vo|
|userbl|userblservice,userdataservice,po,vo|
|userdataservice|po|
|userdata|userdataservice,datatool,po|
|chat|chatservice|
|chatservice|RMI,vo|
|chatbl|chatblservice,chatdataservice|
|chatblservice|RMI,vo|
|chatdataservice|po|
|chatdata|chatdataservice,datatool,po|
|logui|logblservice,datatool|
|logbl|logblservice,logdataservice,userbl,vo|
|logblservice|RMI,vo|
|logdataservice|po|
|logdata|logdataservice,datatool,po|
|mainui|userblservice,vo,po,chatblservice,accountui,stockui,bookui,clientui,financeui,formui,logui,purchaseui,reviseui,saleui,,strategyui,userui|
|po||
|vo||
|datatool|Java IO|

客户端开发包图如下图所示。
![客户端开发包图](http://101.37.19.32:10080/161250103/ManageSystem/raw/wulinyang/doc/graph/%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BC%80%E5%8F%91%E5%8C%85%E5%9B%BE.png)

服务器端开发包图如下图所示。
![服务器端开发包图](http://101.37.19.32:10080/161250103/ManageSystem/raw/wulinyang/doc/graph/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E5%BC%80%E5%8F%91%E5%8C%85%E5%9B%BE.png)

### 4.2 运行时进程
在灯厂进销存系统中，会有多个客户端进程和一个服务器端进程，其进程图如图5所示。结合部署图，客户端进程是在客户端机器上进行，服务器端进程在服务器端机器上运行。
进程图如图
![进程图](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/%E8%BF%9B%E7%A8%8B%E5%9B%BE.jpg)

## 5.接口视角

### 5.1 模块的职责
客户端的模块视图和各层的职责如下所示  
![客户端模块视图](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/%E6%A8%A1%E5%9D%97%E8%A7%86%E5%9B%BE%E5%AE%A2%E6%88%B7%E7%AB%AF.png)
#### 客户端各层的职责

|层|职责|
|---|
|启动模块|负责初始化网络通信机制，启动用户界面|
|展示层|基于窗口的灯厂进销存系统客户端用户界面|
|控制模块|负责控制用户界面的切换及数据的更改|
|客户端网络模块|利用Java RMI机制查找RMI服务|

服务器端的模块视图和各层的职责如下所示
![服务器端模块视图](http://101.37.19.32:10080/161250103/ManageSystem/raw/JinBingShu/doc/graph/%E6%A8%A1%E5%9D%97%E8%A7%86%E5%9B%BE%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF.png)

#### 服务器端各层的职责

|层|职责|
|---|---|
|服务器端网络模块|利用Java RMI机制开启RMI服务，注册RMI服务|
|业务逻辑模块|对来自客户端的请求进行相应并进行业务逻辑处理|
|数据模块|负责数据的持久化和数据访问接口|
|启动模块|负责初始化网络通讯机制|

层之间调用的接口如下所示

|接口|服务调用方|服务提供方|
|---|---|---|
|stockblservice<br>clientblservice<br>purchaseblservice<br>saleblservice<br>accountblservice<br>financeblservice<br>formblservice<br>bookblservice<br>reviseblservice<br>strategyblservice<br>userblservice<br>chatblservice<br>logblservice|客户端展示层|服务器端业务逻辑层|
|stockdataservice<br>clientdataservice<br>accountdataservice<br>bookdataservice<br>revisedataservice<br>strategydataservice<br>userdataservice<br>chatdataservice<br>logdataservice|服务器端业务逻辑层|服务器端数据层|

### 5.2 用户界面层的分解
根据需求，系统存在19个界面：用户主界面，登陆界面，商品分类界面，商品详细信息界面，库存查看界面，报警设置界面，客户信息界面，客户详细信息界面，新建账目界面，审批单据界面，促销策略列表界面，促销策略制定界面，账户列表界面，销售明细表界面，经营历程表界面，经营情况表界面，系统提示界面，系统询问界面，文本输入界面，消息列表界面  
界面跳转如图所示
![用户界面跳转](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%95%8C%E9%9D%A2%E5%93%8D%E5%BA%94%E5%9B%BE.png)
#### 5.2.1 用户界面层模块的职责
|模块|职责|
|---|
|Frame|界面模块，负责界面的显示|

#### 5.2.2 用户界面层模块的接口规范
<table>
      <tr>
          <th rowspan="3">Main_ui</th>
          <th>语法</th>
          <td>Init(args:String[])</td>
      </tr>
      <tr>
          <th>前置条件</th>
          <td>无</td>
      </tr>
      <tr>
          <th>后置条件</th>
          <td>显示MainFrame</td>
      </tr>
      <tr>
          <th rowspan="3">User_ui</th>
          <th>语法</th>
          <td>Init(args:String[])</td>
      </tr>
      <tr>
          <th>前置条件</th>
          <td>MainFrame的调用</td>
      </tr>
      <tr>
          <th>后置条件</th>
          <td>显示LoginFrame</td>
      </tr>
      <tr>
          <th rowspan="3">Sale_ui</th>
          <th>语法</th>
          <td>Init(args:String[])</td>
      </tr>
      <tr>
          <th>前置条件</th>
          <td>MainFrame的调用</td>
      </tr>
      <tr>
          <th>后置条件</th>
          <td>显示ReceiptFrame</td>
      </tr>
      <tr>
          <th rowspan="3">Stock_ui</th>
          <th>语法</th>
          <td>Init(args:String[])</td>
      </tr>
      <tr>
          <th>前置条件</th>
          <td>MainFrame的调用</td>
      </tr>
      <tr>
          <th>后置条件</th>
          <td>显示GoodsFrame/StockFrame</td>
      </tr>
      <tr>
          <th rowspan="3">Client_ui</th>
          <th>语法</th>
          <td>Init(args:String[])</td>
      </tr>
      <tr>
          <th>前置条件</th>
          <td>MainFrame的调用</td>
      </tr>
      <tr>
          <th>后置条件</th>
          <td>显示ClientFrmae</td>
      </tr>
      <tr>
          <th rowspan="3">Purchase_ui</th>
          <th>语法</th>
          <td>Init(args:String[])</td>
      </tr>
      <tr>
          <th>前置条件</th>
          <td>MainFrame的调用</td>
      </tr>
      <tr>
          <th>后置条件</th>
          <td>显示ReceiptFrame</td>
      </tr>
      <tr>
          <th rowspan="3">Account_ui</th>
          <th>语法</th>
          <td>Init(args:String[])</td>
      </tr>
      <tr>
          <th>前置条件</th>
          <td>MainFrame的调用</td>
      </tr>
      <tr>
          <th>后置条件</th>
          <td>显示AccountFrame</td>
      </tr>
      <tr>
          <th rowspan="3">Finance_ui</th>
          <th>语法</th>
          <td>Init(args:String[])</td>
      </tr>
      <tr>
          <th>前置条件</th>
          <td>MainFrame的调用</td>
      </tr>
      <tr>
          <th>后置条件</th>
          <td>显示ReceiptFrame</td>
      </tr>
      <tr>
          <th rowspan="3">Form_ui</th>
          <th>语法</th>
          <td>Init(args:String[])</td>
      </tr>
      <tr>
          <th>前置条件</th>
          <td>MainFrame的调用</td>
      </tr>
      <tr>
          <th>后置条件</th>
          <td>显示FormsFrame</td>
      </tr>
      <tr>
          <th rowspan="3">Book_ui</th>
          <th>语法</th>
          <td>Init(args:String[])</td>
      </tr>
      <tr>
          <th>前置条件</th>
          <td>MainFrame的调用</td>
      </tr>
      <tr>
          <th>后置条件</th>
          <td>显示BookBuildFrame</td>
      </tr>
      <tr>
          <th rowspan="3">Revise_ui</th>
          <th>语法</th>
          <td>Init(args:String[])</td>
      </tr>
      <tr>
          <th>前置条件</th>
          <td>MainFrame的调用</td>
      </tr>
      <tr>
          <th>后置条件</th>
          <td>显示ReviseFrame</td>
      </tr>
      <tr>
          <th rowspan="3">Strategy_ui</th>
          <th>语法</th>
          <td>Init(args:String[])</td>
      </tr>
      <tr>
          <th>前置条件</th>
          <td>MainFrame的调用</td>
      </tr>
      <tr>
          <th>后置条件</th>
          <td>显示StrategyFrame</td>
      </tr><tr>
          <th rowspan="3">Chat_ui</th>
          <th>语法</th>
          <td>Init(args:String[])</td>
      </tr>
      <tr>
          <th>前置条件</th>
          <td>MainFrame的调用</td>
      </tr>
      <tr>
          <th>后置条件</th>
          <td>显示ChatFrame</td>
      </tr>
      <tr>
          <th rowspan="3">Log_ui</th>
          <th>语法</th>
          <td>Init(args:String[])</td>
      </tr>
      <tr>
          <th>前置条件</th>
          <td>MainFrame的调用</td>
      </tr>
      <tr>
          <th>后置条件</th>
          <td>显示LogFrame</td>
      </tr>
  </table>

#### 5.2.3 用户界面模块设计原理
用户界面利用Java的javafx库来实现。

### 5.3 业务逻辑层的分解

#### 5.3.1 业务逻辑层模块的职责
业务逻辑层的设计如下图
![业务逻辑层模块示意图](http://101.37.19.32:10080/161250103/ManageSystem/raw/master/doc/graph/%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%B1%82%E6%A8%A1%E5%9D%97%E7%A4%BA%E6%84%8F%E5%9B%BE.png)
业务逻辑层各个模块的职责如下表所示

|模块|职责|
|---|---|
|stockbl|实现库存管理界面所需的相关服务|
|clientbl|实现客户管理界面需要的相关服务|
|purchasebl|实现进货与进货退货界面所需的相关服务|
|salebl|实现销售与销售退货界面所需的相关服务|
|accountbl|实现银行账户管理界面所需的相关服务|
|financebl|实现付款、收款、现金费用管理界面所需的相关服务|
|formbl|实现销售明细表、经营历程表、经营情况表界面所需的相关服务|
|bookbl|实现期初建账界面所需的服务|
|revisebl|实现审批单据界面所需的服务|
|strategybl|实现制定促销策略界面所需的相关服务|
|userbl|实现登录界面所需的相关服务|
|chatbl|实现消息界面所需的相关服务|
|logbl|实现日志界面所需的相关服务|

#### 5.3.2 业务逻辑层模块的接口规范

#### 5.3.2.1 stockbl接口规范如下所示

#### 5.3.2.1.1 **供接口**

||语法|前置条件|后置条件|
|---|---|--|--|
|Stock.showClass|public ArrayList&lt;ClassVO> showClass();|无|返回一个记录有商品分类信息的列表|
|Stock.showClass|public ClassVO showClass(String id);|id!=null且id存在|返回该id对应的商品分类|
|Stock.addClass|public boolean addClass(ClassVO obj);|无|新增一个商品分类|
|Stock.delClass|public boolean delClass(String id);|id不为空且该id存在|删除该id对应的商品分类|
|Stock.modifyClass|public boolean modifyClass(ClassVO obj);|obj不为空且信息完整|修改该obj对应的原商品分类信息|
|Stock.addGoods|public boolean addGoods(InGoodsVO obj);|obj!=null且信息完整|增加一个商品|
|Stock.delGoods|public boolean delGoods(String id);|id!=null且该id存在|删除该id对应的商品|
|Stock.modifyGoods|public boolean modifyGoods(OutGoodsVO obj);|obj!=null且信息完整|修改该obj对应的原商品分类信息|
|Stock.getGoods|public OutGoodsVO getGoods(String id);|返回该id对应的商品|
|Stock.getGoods|public ArrayList&lt;OutGoodsVO> getGoods();|无|返回一个记录所有商品信息的列表|
|Stock.findGoods|public ArrayList&lt;OutGoodsVO>findGoods(GoodsQueryItem obj);|obj!=null|返回obj对应的搜索条件下的商品列表|
|Stock.stockCheck|public StockCheckResultVO stockCheck(String goodsId,Calendar start, Calendar end);|结束时间在开始时间之后|返回该时间段内的该goodsid对应商品的库存变动信息|
|Stock.stockCheckDetail|public ReceiptVO stockCheckDetail(String id);|id符合输入规则|查找单据编号吻合的单据，返回单据内容|
|Stock.stockInventory|public ArrayList&lt;OutGoodsVO> stockInventory();|无|查询当前的库存信息|
|Stock.addReceipt|public boolean addReceipt(ReceiptVO obj);|obj!=null|新增一个未审批单据|

#### 5.3.2.1.2 **需接口**

|服务名|服务|
|---|---|
|StockDataService.getGoods(String id)|查找该id对应的商品|
|StockDataService.getGoods()|查找所有商品|
|StockDataService.addGoods(GoodsPO obj)|新增一个商品|
|StockDataService.delGoods(String id)|删除该id对应的商品|
|StockDataService.modifyGoods(GoodsPO obj)|修改obj对应的原商品的信息|
|StockDataService.addClass(ClassPO obj)|新增一个商品分类|
|StockDataService.delClass(String id)|删除该id对应的商品分类|
|StockDataService.modifyClass(ClassPO obj)|修改该obj对应的原商品分类的信息|
|StockDataService.showClass()|返回商品分类列表|
|StockDataService.showClass(String fatherId)|根据父类id返回子类列表|
|StockDataService.show(String id)|返回该id对应的商品分类|
|StockDataService.readReceipt(int type)|根据type返回已审批单据|
|StockDataService.readReceipt(String id)|根据id返回已审批单据|
|ReviseDataService.add(ReceiptPO r)|新增一个未审批单据|


#### 5.3.2.2 clientbl接口规范如下所示

#### 5.3.2.2.1 **供接口**

||语法|前置条件|后置条件|
|---|
|Client.addClient|public boolean addClient(ClientVO obj);|obj!=null|新增一个客户|
|Client.delClient|public boolean delClient(String id);|id不为空且id存在|删除该id对应的客户|
|Client.modifyClient|public boolean modifyClient(ClientVO obj);|obj!=null|修改obj对应的原客户的信息|
|Client.showClient|public ClientVO showClient(String id);|id不为空且id存在|返回该id对应的客户|
|Client.show|public ArrayList&lt;ClientVO> show();|无|返回所有客户信息列表|
|Client.searchClientbyNameTelCounterTypeLevel|public ArrayList<ClientVO> searchClientbyNameTelCounterTypeLevel(String name, String tel, String counterman, int type, int level);|无|返回信息匹配的客户|

#### 5.3.2.2.2 **需接口**

|服务名|服务|
|---|---|
|ClientDataService.searchClient(String name, String tel, String counterman, int type, int level)|返回信息匹配的客户列表|
|ClientDataService.addClient(ClientPO obj)|增加一个客户|
|ClientDataService.deleteClient(String id)|删除该id对应的客户|
|ClientDataService.updateClient(ClientPO obj)|修改该obj对应的原客户信息|
|ClientDataService.show()|返回客户信息列表|


#### 5.3.2.3 purchasebl接口规范如下所示

#### 5.3.2.3.1 **供接口**

||语法|前置条件|后置条件|
|---|
|Purchase.showGoods_p|public ArrayList&lt;OutGoodsVO> showGoods_p()|制定单据之前，从商品选择界面选择商品|返回商品列表|
|Purchase.showClient_p|public ArrayList&lt;ClientVO> showClient_p()|制定单据之前，从客户选择界面选择客户|返回客户列表|
|Purchase.makePurchaseList|public PurchaseReceiptVO makePurchaseList(PurchaseReceiptVO obj)|obj!=null|制定进货单|
|Purchase.makePurchaseReturnList|public PurchaseReturnReceiptVO makePurchaseReturnList(PurchaseReturnReceiptVO obj)|obj!=null|制定进货退货单|
|Purchase.showMyUnrevisedReceipts_p|public ArrayList&lt;PurchaseReceiptBothVO> showMyUnrevisedReceipts_p(String userId,int operand, Calendar startTime, Calendar endTime)|所有参数均不为null|根据operand返回该时间段内的未审批的进货或退货类单据|
|Purchase.makePurchaseReceiptDraft|public PurchaseReceiptVO makePurchaseReceiptDraft(PurchaseReceiptVO obj, String userId)|obj!=null,userId!=null且存在|将该单据加入草稿箱|
|Purchase.makePurchaseReturnReceiptDraft|public PurchaseReturnReceiptVO makePurchaseReturnReceiptDraft(PurchaseReturnReceiptVO obj, String userId)|obj!=null,userId!=null且存在|将该单据加入草稿箱|
|Purchase.showMyPurchaseReceiptDrafts|public ArrayList&lt;PurchaseReceiptVO> showMyPurchaseReceiptDrafts(String userId)|userId!=null且存在|返回该用户的进货类单据草稿列表|
|Purchase.showMyPurchaseReturnReceiptDrafts|public ArrayList<PurchaseReturnReceiptVO> showMyPurchaseReturnReceiptDrafts(String userId)|userId!=null且存在|返回该用户的退货类单据草稿列表|
|Purchase.modifyPurchaseReceiptDraft|public PurchaseReceiptVO modifyPurchaseReceiptDraft(PurchaseReceiptVO obj, String userId)|obj!=null,userId!=null|修改obj对应的原进货单据的信息|
|Purchase.modifyPurchaseReturnReceiptDraft|public PurchaseReturnReceiptVO modifyPurchaseReturnReceiptDraft(PurchaseReturnReceiptVO obj, String userId)|obj!=null,userId!=null|修改obj对应的原退货单据的信息|
|Purchase.deleteDraft_p|public boolean deleteDraft_p(String draftId, String userId)|draftId!=null且存在,userId!=null且存在|删除对应的单据草稿|

#### 5.3.2.3.2 **需接口**

|服务名|服务|
|---|---|
|ReviseDataService.add(ReceiptPO r)|新建一个单据|
|ReviseDataService.finds()|返回所有未审批单据|
|StockDataService.getGoods()|查找所有商品|
|StockDataService.addDraft(ReceiptPO obj, String userId)|新增单据草稿|
|StockDataService.delDraft(String draftId, String userId)|删除信息匹配的单据草稿|
|StockDataService.modifyReceipt(ReceiptPO obj)|修改obj对应的单据草稿|
|StockDataService.readDraft(String userId)|返回该用户的单据草稿列表|
|ClientDataService.show()|返回客户信息列表|

#### 5.3.2.4 salebl接口规范如下所示

#### 5.3.2.4.1 **供接口**

||语法|前置条件|后置条件|
|---|
|Sale.showGoods|public ArrayList&lt;OutGoodsVO> showGoods()|制定单据之前，从商品选择界面选择商品|返回商品列表|
|Sale.showClient|public ArrayList&lt;ClientVO> showClient()|制定单据之前，从客户选择界面选择客户|返回客户列表|
|Sale.makeSaleList|public SaleReceiptVO makeSaleList(SaleReceiptVO obj)|obj!=null|制定销售单,保存并返回该单据|
|Sale.makeSaleReturnList|public SaleReturnReceiptVO makeSaleReturnList(SaleReceiptVO obj)|obj!=null|制定销售退货单,保存并返回该单据|
|Sale.chooseGiftStrategy|public StockGiftReceiptVO chooseGiftStrategy(String strategyId,String userId,SaleReceiptBothVO receipt)|各参数均不为null|根据选择的促销策略生成库存赠送单，保存并返回|
|Sale.chooseOtherStrategy|public boolean chooseOtherStrategy(String strategyId,String userId,SaleReceiptBothVO receipt)|各参数均不为null|根据促销策略的内容更改销售单据的数据|
|Sale.showMyUnrevisedReceipts|public ArrayList&lt;SaleReceiptBothVO> showMyUnrevisedReceipts(String userId,int operand, Calendar startTime, Calendar endTime)|各参数均不为null|根据operand返回该时间段内的未审批的销售或销售退货类单据|
|Sale.showValidStrategy|public ArrayList&lt;StrategyVO> showValidStrategy(SaleReceiptBothVO saleReceipt)|saleReceipt各项数据均不为null|根据已有的单据搜索满足条件的促销策略|
|Sale.makeSaleReceiptDraft|public SaleReceiptVO makeSaleReceiptDraft(SaleReceiptVO obj, String userId)|obj!=null,userid!=null且存在|将该单据草稿加入草稿箱|
|Sale.makeSaleReturnReceiptDraft|public SaleReturnReceiptVO makeSaleReturnReceiptDraft(SaleReturnReceiptVO obj, String userId)|obj!=null,userid!=null且存在|将该单据草稿加入草稿箱|
|Sale.showMySaleReceiptDrafts|public ArrayList&lt;SaleReceiptVO> showMySaleReceiptDrafts(String userId)|userId!=null且存在|返回该用户的销售类单据草稿|
|Sale.showMySaleReturnReceiptDrafts|public ArrayList&lt;SaleReturnReceiptVO> showMySaleReturnReceiptDrafts(String userId)|userId!=null且存在|返回该用户的销售退货类单据草稿|
|Sale.modifySaleReceiptDraft|public SaleReceiptVO modifySaleReceiptDraft(SaleReceiptVO obj, String userId)|obj!=null,userId!=null|修改obj对应的原销售单据的信息|
|Sale.modifySaleReturnReceiptDraft|public SaleReturnReceiptVO modifySaleReturnReceiptDraft(SaleReturnReceiptVO obj, String userId)|obj!=null,userId!=null|修改obj对应的原销售退货单据的信息|
|Sale.deleteDraft|public boolean deleteDraft(String draftId, String userId)|draftId!=null且存在,userId!=null且存在|删除对应的单据草稿|
|Sale.getStrategyById|public StrategyVO getStrategyById(String id)|id!=null且存在|返回该id对应的促销策略|
|Sale.makeGiftReceipt|public boolean makeGiftReceipt(StockGiftReceiptVO receipt)|receipt!=null|新增一个库存赠送单|

#### 5.3.2.4.2 **需接口**

|服务名|服务|
|---|---|
|ReviseDataService.add(ReceiptPO r)|新建一个单据|
|ReviseDataService.finds()|返回所有未审批单据|
|StockDataService.getGoods()|查找所有商品|
|StockDataService.addDraft(ReceiptPO obj, String userId)|新增单据草稿|
|StockDataService.delDraft(String draftId, String userId)|删除信息匹配的单据草稿|
|StockDataService.modifyReceipt(ReceiptPO obj)|修改obj对应的单据草稿|
|StockDataService.readDraft(String userId)|返回该用户的单据草稿列表|
|ClientDataService.show()|返回客户信息列表|
|StrategyDataService.find(String id)|查找该id对应的促销策略|
|StrategyDataService.finds()|返回所有促销策略|

#### 5.3.2.5 accountbl接口规范如下所示

#### 5.3.2.5.1 **供接口**

||语法|前置条件|后置条件|
|---|
|Account.addAccount|public AccountVO addAccount(AccountVO obj);|obj!=null|增加一个银行账户并返回|
|Account.findAccount|public AccountVO findAccount(String id);|id!=null|根据id查找一个账户，找不到返回null|
|Account.deleteccount|public boolean deleteAccount(String AccountId);|AccountId!=null|删除一个账户，删除成功返回true|
|Account.login|public boolean login(String id,String password);|id,password!=null|先根据id查询账户是否存在，然后检验password是否匹配，若匹配，则返回true,否则返回false|
|Account.checkUserLevel|public boolean checkUserLevel(String userId);|userId!=null|根据userId返回当前用户的权限是否足够|
|Account.updateAccount|public boolean updateAccount(AccountVO obj);|obj!=null|更新obj对应的原银行账户信息|
|Account.updateBalance|public boolean updateBalance(String accountId, double difference);|accountId!=null|更新该账户的余额|
|Account.getAccounts|public ArrayList&lt;AccountVO> getAccounts();|无|返回所有的银行账户|


#### 5.3.2.5.2 **需接口**

|服务名|服务|
|---|---|
|AccountDataService.add(AccountPO account))|增加一个账户|
|AccountDataService.delete(String accountId)|删除一个账户|
|AccountDataService.updateAccount(AccountPO account)|修改一个账户|
|AccountDataService.findById(String id)|根据id查找一个账户|
|AccountDataService.findByNickname(String nickname)|根据名称查找一个账户|
|AccountDataService.showAll()|返回所有银行账户列表|
|AccountDataService.updateBalance(String accountId, double newBalance)|更新该账户的余额|

#### 5.3.2.6 financebl接口规范如下所示

#### 5.3.2.6.1 **供接口**

||语法|前置条件|后置条件|
|---|
|Finance.showGoods|public ArrayList&lt;String> showAccounts();|制定单据之前，从银行账户选择界面选择银行账户|返回银行账户列表|
|Finance.showClient|public ArrayList&lt;ClientVO> showClients();|制定单据之前，从客户选择界面选择客户|返回客户列表|
|Finance.getAccount|public AccountVO getAccount(String nickName)|存在nickName对应的账户|返回nickName对应的账户vo|
|Finance.makeCashReceipt|public boolean makeCashReceipt(FinanceCashReceiptVO cashReceipt);|cashReceipt!=null|制定现金费用单|
|Finance.makePayReceipt|public boolean makePayReceipt(FinancePayReceiptVO payReceipt);|payReceipt!=null|制定付款单|
|Finance.makeCollectReceipt|public boolean makeColeectReceipt(FinanceCollectReceiptVO collectReceipt);|collectReceipt!=null|制定收款单|
|Finance.readReceipt|public ReceiptVO readReceipt(String receiptID);|receiptID!=null|返回该id对应的单据|
|Finance.readRevisedReceiptList|public ArrayList&lt;ReceiptVO> readRevisedReceiptList(String userId);|userId!=null|返回该用户的已审批单据列表|
|Finance.readUnrevisedReceiptList|public ArrayList&lt;ReceiptVO> readUnrevisedReceiptList(String userId);|userId!=null|返回该用户的未审批单据列表|
|Finance.readUnrevisedReceipt|public ReceiptVO readUnrevisedReceipt(String receiptID);|receiptID!=null|返回该id对应的未审批单据|
|Finance.addDraft|public boolean addDraft(ReceiptVO receipt,String userID);|receipt!=null,userID!=null|将该单据草稿加入草稿箱|
|Finance.delDraft|public boolean addDraft(String draftId,String userID);|draftId!=null,userID!=null|删除该单据草稿|
|Finance.modifyDraft|public boolean addDraft(ReceiptVO receipt,String userID);|receipt!=null,userID!=null|更新该单据草稿|
|Finance.readDraftList|public ArrayList&lt;ReceiptVO> readDraftList(String userID);|userID!=null|返回该用户的所有财务类单据草稿列表|
|Finance.readDraft|public ReceiptVO readDraft(String draftID, String userId);|draftId!=null,userID!=null|返回该id对应的单据草稿|


#### 5.3.2.6.2 **需接口**

|服务名|服务|
|---|---|
|ClientDataService.show()|返回客户信息列表|
|AccountDataService.showAll()|返回银行账户信息列表|
|StockDataService.addDraft(ReceiptPO obj, String userId)|新增单据草稿|
|StockDataService.delDraft(String draftId, String userId)|删除信息匹配的单据草稿|
|StockDataService.modifyReceipt(ReceiptPO obj)|修改obj对应的单据草稿|
|StockDataService.readDraft(String userId)|返回该用户的单据草稿列表|
|StockDataService.readDraft(String draftId, String userId)|返回该id对应的单据草稿|
|StockDataService.readReceipt(String id)|返回该id对应的已审批单据|
|StockDataService.readReceipt()|返回所有已审批单据|
|ReviseDataService.find(String id)|根据id返回未审批单据|
|ReviseDataService.add(ReceiptPO r)|新建一个单据|
|ReviseDataService.finds()|返回所有未审批单据|


#### 5.3.2.7 formbl接口规范如下所示

#### 5.3.2.7.1 **供接口**

||语法|前置条件|后置条件|
|---|
|Form.saleList|public ArrayList&lt;SaleFormLineItem> saleList(Calendar beginTime, Calendar endTime, String condition);|beginTime!=null,endTime!=null,beginTime在endTime之前|根据筛选条件查看销售明细表|
|Form.recordList|public ArrayList&lt;ReceiptVO> recordList(Calendar beginTime, Calendar endTime, String condition);|beginTime!=null,endTime!=null,beginTime在endTime之前|根据筛选条件查看经营历程表|
|Form.showDetailReceipt|public ReceiptVO showDetailReceipt(String id);|查看单据详细信息|
|Form.offset|public boolean ofMfset(String id);|Receipt!=null|红冲|
|Form.offsetAndCopy|public boolean offsetAndCopy(ReceiptVO offsetReceipt);|offsetReceipt!=null|红冲并复制|
|Form.businessList|public double[] businessList(Calendar beginTime, Calendar endTime);|beginTime!=null,endTime!=null,beginTime在endTime之前|根据时间区间查看经营情况表|

#### 5.3.2.7.2 **需接口**

|服务名|服务|
|---|---|
|StockDataService.readReceipt(int type)|返回该类型的所有已审批单据|
|StockDataService.readReceipt(String id)|返回该id对应的已审批单据|
|ReviseDataService.add(ReceiptVO r)|新增一个单据|


#### 5.3.2.8 bookbl接口规范如下所示

#### 5.3.2.8.1 **供接口**

||语法|前置条件|后置条件|
|---|
|Book.initBook|public boolean initBook();|无|在上一套账目的基础上初始化账目|
|Book.showBook|public BookVO showBook();|无|展示期初账目信息|
|Book.saveDraft|public boolean saveDraft();|无|保存当前账目为草稿|
|Book.cancelChange|public void cancelChange();|无|删除所有修改，返回最初状态|
|Book.showBook|public BookVO showBook();|无|返回当前账目|
|Book.getNow|public BookVO getNow();|无|获得一个时间为null的包含有当前所有库中信息的账目|
|Book.creatingBook|public void creatingBook();|进入建账状态|创建新账目|


#### 5.3.2.8.2 **需接口**

|服务名|服务|
|---|---|
|BookDataService.initBook(BookPO book)|在上一套账目的基础上初始化账目|
|BookDataService.showBook()|展示期初账目信息|
|BookDataService.saveDraft()|保存当前账目为草稿|
|BookDataService.cancelChange()|删除所有修改，返回最初状态|
|BookDataService.showBook()|返回当前账目|
|BookDataService.getNow()|获得一个时间为null的包含有当前所有库中信息的账目|
|BookDataService.creatingBook()|创建新账目|
|StockDataService.getGoods()|查找所有商品|
|StockDataService.showClass()|返回商品分类列表|
|ClientDataService.show()|返回客户信息列表|
|AccountDataService.showAll()|返回银行账户信息列表|

#### 5.3.2.9 revisebl接口规范如下所示

#### 5.3.2.9.1 **供接口**

||语法|前置条件|后置条件|
|---|---|----|
|Revise.showAllReceipt|public ArrayList&lt;ReceiptVO> showAllReceipt(String userID);|无|展示该用户的所有未审批单据列表|
|Revise.showReceipt|public ReceiptVO showReceipt(String id);|id!=null|根据单据编号查找单据，返回单据信息|
|Revise.revise|public boolean revise(ReceiptVO receiptVO,int operand);|receiptVO!=null，operand在规定范围内|审批单一单据|
|Revise.updateReceipt|pupublic boolean updateReceipt(ReceiptVO r);|r!=null|更新r对应的原单据|

#### 5.3.2.9.2 **需接口**

|服务名|服务|
|---|---|
|ReviseDataService.finds()|查找所有未审批的单据持久化对象|
|ReviseDataService.find(String id)|根据单据编号查找单一持久化对象|
|ReviseDataService.update(ReceiptPO r)|更新单一持久化对象（更改审批状态）|
|ReviseDataService.delete(String id)|根据单据编号删除未审批单据|
|StockDataService.writeReceipt(ReceiptPO obj)|新增已审批单据|
|StockDataService.getGoods(String id)|根据商品编号返回商品|
|StockDataService.modifyGoods(GoodsPO obj)|更新商品信息|
|ChatDataService.saveMsg(String userName, String msg)|储存消息|
|ClientDataService.showClient(String properties|根据匹配信息返回客户|
|ClientDataService.modifyClient(ClientPO obj)|更新客户信息|
|AccountDataService.updateBalance(String accountId, double newBalance)|更新银行账户余额|


#### 5.3.2.10 strategybl接口规范如下所示

#### 5.3.2.10.1 **供接口**

||语法|前置条件|后置条件|
|---|
|Strategy.findAllStrategy|public ArrayList&lt;StrategyVO> findAllStrategy();|无|展示已有的促销策略列表|
|Strategy.findStrategy|public StrategyVO findStrategy(String id);|无|根据展示选中的促销策略的id返回详细信息|
|Strategy.makeStrategy|public boolean makeStrategy(StrategyVO obj);|obj!=null|制定新的促销策略|
|Strategy.removeStrategy|public boolean removeStrategy(String id);|id!=null|删除原有的促销策略|

#### 5.3.2.10.2 **需接口**

|服务名|服务|
|---|---|
|StrategyDataService.insert(StrategyPO strategy)|插入新的单一持久化对象|
|StrategyDataService.update(StrategyPO strategy)|删除单一持久化对象|
|StrategyDataService.delete(StrategyPO strategy)|更新单一持久化对象|
|StrategyDataService.finds()|查找多个持久化对象|
|StrategyDataService.find(String id)|查找单一持久化对象|

#### 5.3.2.11 userbl接口规范如下所示

#### 5.3.2.11.1 **供接口**

||语法|前置条件|后置条件|
|---|
|User.userlogin|public boolean userlogin(String id,String password);|id,password!=null|登录系统用户|
|User.userlogout|public boolean userlogout(String id);|id!=null|登出当前系统用户|
|User.addUser|public boolean addUser(String id,String password);|id,password!=null|系统管理员新增系统用户|
|User.removeUser|public boolean removeUser(String id);|id!=null|系统管理员删除系统用户|
|User.modifyUser|public boolean modifyUser(UserVO obj);|obj!=null|系统管理员修改系统用户|
|User.showUsers|public ArrayList&lt;UserVO> showUsers(String Info);|无|根据信息返回系统用户列表|
|User.showUser|public UserVO showUser(String id);|id!=null|根据id返回系统用户|

#### 5.3.2.11.2 **需接口**

|服务名|服务|
|---|---|
|UserDataService.insert(UserPO User)|插入新的单一持久化对象|
|UserDataService.update(UserPO User)|删除单一持久化对象|
|UserDataService.delete(UserPO User)|更新单一持久化对象|
|UserDataService.finds()|查找多个持久化对象|
|UserDataService.find(String id)|查找单一持久化对象|

#### 5.3.2.12 logbl接口规范如下所示

#### 5.3.2.12.1 **供接口**
||语法|前置条件|后置条件|
|---|
|Log.saveLog|public boolean saveLog(String userId,String content);|userId!=null|存储该用户日志|
|Log.readLog|public String readLog(String userId);|userId!=null|读取该用户日志|

#### 5.3.12.2 **需接口**
|服务名|服务|
|---|---|
|LogDataService.saveLog(String userId,String content)|存储该用户日志到txt中|
|LogDataService.readLog(String userId)|从txt中读取该用户日志|
|UserDataService.find(String id)|查找单一持久化对象|

#### 5.3.2.13 chatbl接口规范如下所示

#### 5.3.2.13.1 **供接口**
||语法|前置条件|后置条件|
|---|
|Chat.remove|public void remove(String name);|name不为空|注销客户端清空消息|
|Chat.uploadTempMsg|public void uploadTempMsg(String name, ArrayList&lt;String> msgs);|name不为空，msgs不为空|从数据库中读取存储的离线消息|

#### 5.3.2.13.2 **需接口**
|服务名|服务|
|---|---|
|ChatDataService.saveMsg(String userName, String msg)|储存该用户离线消息|
|ChatDataService.readMsg(String userName)|读取该用户消息|


### 5.4 数据层的分解

数据层主要给业务逻辑层提供数据访问服务，包括对持久化数据的增、删、改、查。
### 5.4.1 stockdata 模块

Stock业务逻辑需要的服务由StockDataService接口提供。StockData模块的具体描述如下图所示。

#### 5.4.1.1 数据层模块的职责
|模块|职责|
|---|---|
|StockDataService|持久化数据库接口，增删改查|
|StockData|实现|


#### 5.4.1.2 数据层模块的接口规范
|||提供的服务（供接口）|
|--|--|
|StockDataService.readReceipt|语法|public ArrayList&lt;ReceiptPO>readReceipt(int type);|
||前置条件|type在规定范围内|
||后置条件|返回该类型的所有已审批单据|
|StockDataService.readReceipt|语法|public ArrayList&lt;ReceiptPO>readReceipt();|
||前置条件|无|
||后置条件|返回所有已审批单据|
|StockDataService.readReceipt|语法|public ReceiptPO readReceipt(String id);|
||前置条件|id!=null且id存在|
||后置条件|返回该id对应已审批单据|
|StockDataService.writeReceipt|语法|public boolean writeReceipt(ReceiptPO obj);|
||前置条件|obj!=null|
||后置条件|新增已审批单据|
|StockDataService.modifyReceipt|语法|public boolean modifyReceipt(ReceiptPO obj);|
||前置条件|obj!=null|
||后置条件|修改该obj对应的已审批单据信息|
|StockDataService.addDraft|语法|public boolean addDraft(ReceiptPO obj,String userId);|
||前置条件|obj!=null,userId!=null|
||后置条件|新增一个单据草稿|
|StockDataService.delDraft|语法|public boolean delDraft(String draftId,String userId);|
||前置条件|draftId!=null,userId!=null|
||后置条件|删除一个单据草稿|
|StockDataService.modifyDraft|语法|public boolean modifyDraft(ReceiptPO obj,String userId);|
||前置条件|obj!=null,userId!=null|
||后置条件|更新一个单据草稿|
|StockDataService.readDraft|语法|public ReceiptPO readDraft(String draftId,String userId);|
||前置条件|draftId!=null,userId!=null|
||后置条件|返回一个单据草稿|
|StockDataService.readDraft|语法|public ArrayList<ReceiptPO>readDraft(String userId);|
||前置条件|userId!=null|
||后置条件|返回该用户所有单据草稿|
|StockDataService.getGoods|语法|public GoodsPO getGoods(String id);|
||前置条件|id不为空|
||后置条件|若存在PO，返回符合条件的PO；若不存在，返回空|
|StockDataService.getGoods|语法|public ArrayList&lt;GoodsPO> getGoods() |
||前置条件|无|
||后置条件|返回所有PO列表|
|StockDataService.addGoods|语法|public boolean addGoods(GoodsPO obj)|
||前置条件|PO不重复|
||后置条件|数据文件中增加一个PO记录|
|StockDataService.delGoods|语法|public boolean delGoods(String id)|
||前置条件|id存在|
||后置条件|数据文件中删除一个PO记录|
|StockDataService.modifyGoods|语法|public boolean modifyGoods(GoodsPO obj)|
||前置条件|PO存在|
||后置条件|数据文件中更新一个PO记录|
|StockDataService.show|语法|public ClassPO show(String id)|
||前置条件|id不为空|
||后置条件|若存在PO，返回符合条件的PO；若不存在，返回空|
|StockDataService.showClass|语法|public ArrayList&lt;ClassPO> showClass(String fatherId) |
||前置条件|fatherId不为空且PO存在|
||后置条件|返回符合条件的PO列表|
|StockDataService.addClass|语法|public boolean addClass(ClassPO obj)|
||前置条件|PO不重复|
||后置条件|数据文件中增加一个PO记录|
|StockDataService.delClass|语法|public boolean delClass(String id)|
||前置条件|id存在|
||后置条件|数据文件中删除一个PO记录|
|StockDataService.modifyClass|语法|public boolean modifyClass(ClassPO obj)|
||前置条件|PO存在|
||后置条件|数据文件中更新一个PO记录|
|StockDataService.showClass|语法|public ArrayList&lt;ClassPO> showClass()|
||前置条件|无|
||后置条件|返回所有商品分类PO|

### 5.4.2 clientdata 模块
Client业务逻辑需要的服务由ClientDataService接口提供。ClientData模块的具体描述如下图所示。

#### 5.4.2.1 数据层模块的职责
|模块|职责|
|---|---|
|ClientDataService|持久化数据库接口，增删改查|
|ClientData|实现|

#### 5.4.2.2 数据层模块的接口规范
|||提供的服务（供接口）|
|--|--|
|ClientDataService.showClient|语法|public ClientPO showClient(String id)|
||前置条件|id不为空|
||后置条件|若存在PO，返回符合条件的PO；若不存在，返回空|
|ClientDataService.show|语法|public ArrayList&lt;ClientPO> show()|
||前置条件|无|
||后置条件|返回所有PO列表|
|ClientDataService.addClient|语法|public boolean addClient(ClientPO obj)|
||前置条件|PO不重复|
||后置条件|在数据文件中添加一个PO记录|
|ClientDataService.deleteClient|语法|public boolean deleteClient(String id)|
||前置条件|id存在|
||后置条件|在数据文件中删除一个PO记录|
|ClientDataService.modifyClient|语法|public boolean modifyClient(ClientPO obj)|
||前置条件|PO存在|
||后置条件|在数据文件中更新一个PO记录|


### 5.4.3 accountdata 模块
Account业务逻辑需要的服务由AccountDataService接口提供。AccountData模块的具体描述如下图所示。

#### 5.4.3.1 数据层模块的职责
|模块|职责|
|---|---|
|AccountDataService|持久化数据库接口，增删改查|
|AccountData|实现|

#### 5.4.3.2 数据层模块的接口规范
|||提供的服务（供接口）|
|--|--|
|AccountDataService.add|语法|public boolean add(AccountPO account)|
||前置条件|无|
||后置条件|创建成功返回true|
|AccountDataService.delete|语法|public boolean delete(String AccountId)|
||前置条件|accountId存在|
||后置条件|删除成功返回true|
|AccountDataService.updateAccount|语法|public boolean updateAccount(AccountPO account)|
||前置条件|account账户名存在，其他信息有更新|
||后置条件|成功返回true|
|AccountDataService.updateBalance|语法|public boolean updateBalance(String accountId,double newBalance)|
||前置条件|accountId存在，newBalance在规定范围内|
||后置条件|成功返回true|
|AccountDataService.findById|语法|public AccountPO findById(String id)|
||前置条件|id存在|
||后置条件|返回AccountPO对象|
|AccountDataService.findByNickname|语法|public AccountPO findByNickname(String nickname)|
||前置条件|nickname存在|
||后置条件|返回AccountPO对象|
|AccountDataService.showAll|语法|public ArrayList&lt;AccountPO> showAll()|
||前置条件|无|
||后置条件|返回所有AccountPO对象|


### 5.4.4 bookdata 模块
Book业务逻辑需要的服务由BookDataService接口提供。BookData模块的具体描述如下图所示。

#### 5.4.4.1 数据层模块的职责
|模块|职责|
|---|---|
|BookDataService|持久化数据库接口，增删改查|
|BookData|实现|

#### 5.4.4.2 数据层模块的接口规范
|||提供的服务（供接口）|
|--|--|
|BookDataService.initBook|语法|public boolean initBook(BookPO book) |
||前置条件|无|
||后置条件|在数据库中增加一个po|
|BookDataService.showBook|语法|public BookVO showBook()|
||前置条件|无|
||后置条件|读取并返回当前期初账目|
|BookDataService.cancelChange|语法|public void cancelChange()|
||前置条件|无|
||后置条件|取消账目修改并返回初始状态|
|BookDataService.creatingBook|语法|public void creatingBook()|
||前置条件|无|
||后置条件|新建账目|
|BookDataService.saveDraft|语法|public boolean saveDraft()|
||前置条件|无|
||后置条件|在数据库中增加一个po(草稿)|


### 5.4.5 revisedata 模块
Revise业务逻辑需要的服务由ReviseDataService接口提供。ReviseData模块的具体描述如下图所示。

#### 5.4.5.1 数据层模块的职责
|模块|职责|
|---|---|
|ReviseDataService|持久化数据库接口，增删改查|
|ReviseData|实现|

#### 5.4.5.2 数据层模块的接口规范
|||提供的服务（供接口）|
|--|--|
|ReviseDataService.finds|语法|public ArrayList&lt;ReceiptPO> finds()|
||前置条件|无|
||后置条件|返回所有未审批的表单|
|ReviseDataService.find|语法|public ReceiptPO find(string id)|
||前置条件|无|
||后置条件|按id进行查找返回相应的po对象|
|ReviseDataService.update|语法|public boolean update(ReceiptPO r)|
||前置条件|数据库中存在同样id的po|
||后置条件|更新一个po|
|ReviseDataService.add|语法|public boolean add(ReceiptPO r)|
||前置条件|数据库中不存在同样id的po|
||后置条件|新增一个po|
|ReviseDataService.delte|语法|public boolean delete(String id)|
||前置条件|数据库中存在该id的po|
||后置条件|删除一个po|


### 5.4.6 strategydata 模块
Strategy业务逻辑需要的服务由StrategyDataService接口提供。StrategyData模块的具体描述如下图所示。

#### 5.4.6.1 数据层模块的职责
|模块|职责|
|---|---|
|StrategyDataService|持久化数据库接口，增删改查|
|StrategyData|实现|

#### 5.4.6.2 数据层模块的接口规范

|||提供的服务（供接口）|
|--|--|
|StrategyDataService.insert|语法|public boolean insert(StrategyPO strategy)|
||前置条件|数据库中不存在同样的促销策略|
||后置条件|在数据库中增加一个po|
|StrategyDataService.update|语法|public boolean update(StrategyPO strategy)|
||前置条件|数据库中存在相同id的po|
||后置条件|更新一个po|
|StrategyDataService.delete|语法|public boolean delete(StrategyPO strategy)|
||前置条件|数据库中存在同样的po|
||后置条件|删除一个po|
|StrategyDataService.find|语法|public StrategyPO find(String id)|
||前置条件|id不为空|
||后置条件|根据id进行查找和返回一个po|
|StrategyDataService.finds|语法|public  ArrayList&lt;StrategyPO> finds()|
||前置条件|无|
||后置条件|返回现有的促销策略列表|


### 5.4.7 userdata 模块
User业务逻辑需要的服务由UserDataService接口提供。UserData模块的具体描述如下图所示。

#### 5.4.7.1 数据层模块的职责
|模块|职责|
|---|---|
|UserDataService|持久化数据库接口，增删改查|
|UserData|实现|

#### 5.4.7.2 数据层模块的接口规范
|||提供的服务（供接口）|
|--|--|
|UserDataService.insert|语法|public boolean insert(UserPO User)|
||前置条件|数据库中不存在同样的UserPO|
||后置条件|在数据库中增加一个po|
|UserDataService.update|语法|public boolean update(UserPO User)|
||前置条件|数据库中存在相同id的po|
||后置条件|更新一个po|
|UserDataService.delete|语法|public boolean delete(UserPO User)|
||前置条件|数据库中存在同样的po|
||后置条件|删除一个po|
|UserDataService.find|语法|public UserPO find(String id)|
||前置条件|id不为空|
||后置条件|根据id进行查找和返回一个po|
|UserDataService.finds|语法|public ArrayList&lt;UserPO> finds(String info)|
||前置条件|无|
||后置条件|根据info查找并返回一个UserPO列表|

### 5.4.8 logdata 模块

#### 5.4.8.1 数据层模块的职责
|模块|职责|
|---|---|
|LogDataService|持久化数据库接口，储存和读取信息|
|LogData|实现|

#### 5.4.8.2 数据层模块的接口规范
|||提供的服务（供接口）|
|--|--|
|LogDataService.saveLog|语法|public boolean saveLog(String userId, String content);|
||前置条件|userId不为空|
||后置条件|储存该用户的日志到txt中|
|LogDataService.readLog|语法|public String readLog(String userId);|
||前置条件|userId不为空|
||后置条件|从txt中读取该用户的日志|

### 5.4.9 chatdata 模块

#### 5.4.9.1 数据层模块的职责
|模块|职责|
|---|---|
|ChatDataService|持久化数据库接口，储存和读取信息|
|ChatData|实现|

#### 5.4.9.2 数据层模块的接口规范
|||提供的服务（供接口）|
|--|--|
|ChatDataService.saveMsg|语法|public boolean saveMsg(String userName, String msg);|
||前置条件|userName和msg不为空|
||后置条件|储存该用户的离线消息|
|ChatDataService.readMsg|语法|public ArrayList&lt;String> readMsg(String userName);|
||前置条件|userName不为空|
||后置条件|读取该用户的离线消息|


## 6 信息视角

### 6.1 数据化持久对象
ClassPO类包含商品分类的编号（Id）、名称、父类、类下商品

GoodPO类包含商品的编号、名称、型号、进价、最近进价、零售价、最近零售价、库存数量、所属分类、警戒值、出厂日期

ClientPO类包含客户的编号、分类（进货商、销售商）、级别（五级，一级普通用户，五级VIP客户）、姓名、电话、地址、邮编、电子邮箱、应收额度、应收、应付、默认业务员。

AccountPO类包含公司银行账户的账户名、余额。

BookPO类是公司的账目，包含添加商品信息（商品分类，某一商品的名称，类别，型号，进价/售价(默认为上年平均)，最近进价和最近售价留空），客户信息（客户分类，某一个客户的名称，联系方式等，应收应付(之前遗留)），银行账户信息（名称，余额）。

UserPO类是系统用户对象，包含属性，id，密码等。

ReceiptPO为单据类的父类

SaleReceiptPO为销售类单据的父类

SaleReceipt类为销售单，包含单据编号、客户、业务员、操作员、仓库、商品列表、折让前总额、折让、使用代金券金额、折让后总额、备注

SaleReturnReceipt类为销售退货单，包含单据编号、客户、业务员、操作员、仓库、商品列表、折让前总额、折让、使用代金券金额、折让后总额、备注

PurchaseReceiptPO为进货类单据的父类

PurchaseReceipt类为进货单，包含单据编号、供应商、仓库、操作员、入库商品列表（名称、型号、数量、单价、金额、备注）、备注、总额合计

PurchaseReturnReceipt类为进货退货单，包含单据编号、供应商、仓库、操作员、入库商品列表（名称、型号、数量、单价、金额、备注）、备注、总额合计

StockReceiptPO为库存类单据的父类

OverflowReceipt类为库存报溢单，包含单据编号、商品信息列表

UnderflowReceipt类为库存报损单，包含单据编号、商品信息列表

StockRecordPO类为库存记录单，包含日期，操作，金额，数量

GiftReceipt类为库存赠送单，包含单据编号、商品信息列表

AlarmReceipt类为库存报警单，包含单据编号、商品信息、报警数量、现有内存

FinanceReceiptPO为财务类单据的父类

FinancePayReceipt类为付款单，包含客户，操作员，总额，商品信息

FinanceCollectReceipt类为收款单，包含客户，操作员，总额，商品信息

FinanceCashReceipt类为现金费用单，包含编号，操作员，银行账户，总额

StrategyPO为促销策略的父类

ClientCouponStrategyPO类为依据客户等级的代金券促销策略，包含促销策略编号、客户等级、代金券金额

ClientDiscountStrategyPO类为依据客户等级的折扣促销策略，包含促销策略编号、客户等级、折让比例

ClientGiftStrategyPO类为依据客户等级的赠品促销策略，包含促销策略编号、赠品列表、客户等级

DiscountStrategyPO类为依据总价的折扣促销策略，包含促销策略编号、最低消费、折扣比例

GiftStrategyPO类为依据总价的折扣促销策略，包含促销策略编号、最低消费、赠品列表

BargainPackageStrategyPO类为特价包促销策略，包含促销策略编号、商品列表、总价




### 6.2 Txt持久化格式
