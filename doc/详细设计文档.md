```Java

# 灯厂进销存系统软件详细设计描述文档

## 更新历史
|修改人员|日期|变更内容|版本号|
|---|--|---|--|
|吴林漾|2017.10.29|最初草稿|V1.0|
|钱宇辰，靳炳淑，吴林漾，王一博|2017.11.01-2017.12.15|分块完成各模块内容|V1.1-V2.0|
|钱宇辰，靳炳淑，吴林漾，王一博|2017.12.22|一致性维护|V2.5|
|王一博|2018.01.11|最终整合|V3.0|

## 目录
1.引言
<menu>1.1编制目的<br>1.2词汇表<br>1.3参考文献<br>

2.产品概述<br>
3.体系结构设计概述<br>
4.结构视角<br>
<menu>4.1 业务逻辑层的分解
<menu><menu>4.1.1 stockbl模块<br>
4.1.2 clientbl模块<br>
4.1.3 purchase模块<br>
4.1.4 sale模块<br>
4.1.5 account模块<br>
4.1.6 finance模块<br>
4.1.7 form模块<br>
4.1.8 book模块<br>
4.1.9 revisebl模块<br>
4.1.10 strategybl模块<br>
4.1.11 userbl模块<br>
4.1.12 chat模块<br>
4.1.13 log模块<br>
<menu>4.2 数据层的分解
<menu><menu>4.2.1 StockData模块<br>
4.2.2 ClientData模块<br>
4.2.3 accountdata模块 <br>
4.2.4 strategyData模块<br>
4.2.5 userData模块<br>
4.2.6 bookdata<br>
4.2.7 chatdata<br>
4.2.8 logdata<br>

5 依赖视角

## 1.引言
### 1.1 编制目的
本报告详细完成对灯厂销存系统的详细设计，达到指导后续软件构造的目的，同时实现和测试人员及用户的沟通。
本报告面向开发人员、测试人员及最终用户而编写，是了解系统的导航。

### 1.2 词汇表
ui	表示某展示层  
bl	表示某逻辑层  
data	表示某数据层

### 1.3 参考资料
1.IEEE std 1471-2000  
2.丁二玉，刘钦.计算与软件工程（卷二）[M]机械工业出版2012：134—182

## 2.产品概述
参考灯厂销存系统用例文档和灯厂销存系统软件需求规格说明文档中对产品的概括描述。

## 3.体系结构设计概述
参考灯厂销存系统体系结构设计文档中对产品的概括描述

## 4.结构视角
## 4.1 业务逻辑层的分解
业务逻辑层的开发包图如下
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/bl%E5%B1%82%E5%88%86%E8%A7%A3/bl%E5%B1%82%E6%80%BB%E4%BD%93%E7%BB%93%E6%9E%84.png)

### 4.1.1 stockbl模块
(1)模块描述<br>
stockbl模块承担的需求参见需求规格说明文档功能需求及相关非功能需求<br>
stockbl模块的职责及接口参见软件体系结构描述文档<br>
(2)整体结构<br>
根据体系结构的设计，我们将系统分为界面层、逻辑层、数据层。每一层之间添加了接口，例如界面层和逻辑层间添加了stockblservice接口，逻辑层和数据层间添加了stockdataservice。
stockbl模块的设计如下图
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/master/doc/graph/bl%E5%B1%82%E5%88%86%E8%A7%A3/Stockbl.png)

stockbl模块各个类职责如下表所示

|模块|职责|
|---|
|StockController|负责实现库存盘点、查询、报警、商品管理、商品分类管理界面的业务|
|Stock|库存对象，拥有库存变动信息的记录，可以处理查询库存变动记录的问题|
|Goods|商品领域的对象，拥有所有商品信息，可以处理商品查询、设置等任务|
|Classes|商品分类领域的对象，拥有所有商品分类信息，可以处理商品分类设置等任务|
|ReceiptInfo|对bl层内提供单据信息的读写操作|
|GoodsInfo|对bl层内提供商品信息的读写操作|
|ClassInfo|对bl层内提供商品分类信息的读写操作|


(3)模块内部类接口规范<br>

StockController供接口<br>

|语法|前置条件|后置条件|
|---|
|public boolean addClass(ClassVO obj);|obj!=null|把新增商品分类信息写入数据库，若添加成功，返回true，否则返回false|
|public boolean delClass(String id);|id!=null|从数据库中删除对应的商品分类信息，若删除成功，返回true，否则返回false|
|public boolean modifyClass(ClassVO obj);|obj!=null|修改数据库中对应的商品分类信息，若修改成功，返回true，否则返回false|
|public ArrayList&lt;ClassVO> showClass();|无|返回所有父分类信息的列表|
|public ArrayList&lt;ClassVO> showClass(String className);|className!=null|返回所有该分类的子分类信息的列表|
|public boolean addGoods(GoodsVO obj);|obj!=null|把新增商品信息写入数据库，若添加成功，返回true，否则返回false|
|public boolean delGoods(String id);|id!=null|从数据库中删除对应的商品信息，若删除成功，返回true，否则返回false|
public boolean modifyGoods(OutGoodsVO obj);|obj!=null|修改数据库中对应的商品信息，若修改成功，返回true，否则返回false|
|public ArrayList&lt;GoodsVO> findGoods(GoodsQueryItem obj);|obj!=null|根据筛选条件返回一个记录有商品信息的列表|
|public OutGoodsVO getGoods(String id);|id!=null|根据id查找商品并返回一个商品VO|
|public ArrayList&lt;OutGoodsVO> getGoods();|无|返回商品列表|
|public StockCheckResultVO stockCheck(String goodsId,Calendar start, Calendar end);|结束时间在开始时间之后|返回该时间段内的库存变动信息|
|public ReceiptVO stockCheckDetail(String id);|receiptID!=null|查找单据编号吻合的单据，返回单据内容|
|public ArrayList &lt;OutGoodsVO> stockInventory();|无|查询当前的库存信息|
|public boolean addReceipt(ReceiptVO obj);|obj!=null|添加库存报溢单或库存保存单，添加单据到待审批区|


StockController需接口<br>
由于StockController并不直接处理业务，只是把业务分配给Stock,Goods,Classes对象，因此StockController需接口同StockController供接口

Stock供接口<br>

|语法|前置条件|后置条件|
|---|
|public StockCheckResultVO stockCheck(String goodsId,Calendar start, Calendar end) |起始时间小于结束时间|Stock对象已经通过StockDataService读取到所有库存变动信息,返回时间区间内的所有库存变动记录|
|public ReceiptVO readReceipt(String id)|id!=null|Stock对象已经通过StockDataService读取到所有库存变动信息,返回单据编号吻合的单据对象|
|public ArrayList&lt;ReceiptVO> readReceipt(int type, Calendar start, Calendar end)|type在定义范围内且起始时间小于结束时间|返回给定时间段内某个种类的单据的集合|
|public ArrayList&lt;ReceiptVO> readReceipt()|无|返回全部单据|
|public boolean writeReceipt(ReceiptVO obj)|obj!=null|若写入成功，返回true；否则返回false|
|public boolean modifyReceipt(ReceiptVO obj)|obj!=null|若修改成功，返回true；否则返回false|
|public boolean addDraft(ReceiptVO obj,String userId)|obj!=null,userId!=null|若写入成功，返回true；否则返回false|
|public boolean delDraft(String draftId,String userId)|darftId,userId!=null|删除成功，返回true；否则返回false|
|public boolean modifyDraft(ReceiptVO obj,String userId)|obj!=null,userId!=null|若修改成功，返回true；否则返回false|
|public ReceiptVO readDraft(String draftId,String userId)|darftId,userId!=null|根据id读取草稿|
|public ArrayList&lt;ReceiptVO>readDraft(String userId)|userId!=null|读取所有草稿|
|public boolean addReceipt(ReceiptVO obj)|obj!=null|添加单据到待审批区|

Stock需接口<br>

|提供者|语法|功能|
|---|
|StockDataService|public ArrayList&lt;ReceiptPO> readReceipt(String type)|查找某个类型的单据|
|StockDataService|public ReceiptPO readReceipt(String id)|返回指定单据的详细信息|
|StockDataService|public ReceiptPO readReceipt()|返回所有单据信息|
|StockDataService|public boolean writeReceipt(ReceiptPO obj)|写入单据信息|
|StockDataService|public boolean modifyReceipt(ReceiptVO obj)|修改单据信息（总经理使用）|
|StockDataService|public boolean addDraft(ReceiptPO obj,String userId)|保存单据草稿|
|StockDataService|public boolean delDraft(String draftId,String userId)|删除单据草稿|
|StockDataService|public boolean modifyDraft(ReceiptPO obj,String userId)|修改单据草稿|
|StockDataService|public ReceiptPO readDraft(String draftId,String userId)|根据id读取草稿|
|StockDataService|public ArrayList&lt;ReceiptPO>readDraft(String userId)|读取所有草稿|
|ReviseInfo|public boolean insertReceipt(ReceiptVO obj)|添加单据到待审批区|



Goods供接口<br>

|语法|前置条件|后置条件|
|---|
|public boolean addGoods(InGoodsVO obj);|obj!=null|把新增商品信息写入数据库，若添加成功，返回true，否则返回false|
|public boolean delGoods(String id);|id!=null|从数据库中删除对应的商品信息，若删除成功，返回true，否则返回false|
|public boolean modifyGoods(OutGoodsVO obj);|obj!=null|修改数据库中对应的商品信息，若修改成功，返回true，否则返回false|
|public ArrayList&lt;OutGoodsVO> findGoods(GoodsQueryItem obj);|obj!=null|根据筛选条件返回一个记录有商品信息的列表|
|public GoodsVO getGoods(String id);|id!=null|根据id查找商品并返回一个商品VO|
|public ArrayList&lt;OutGoodsVO> getGoods();|无|返回商品列表|

Goods需接口<br>

|提供者|语法|功能|
|---|
|StockDataService|public boolean addGoods(GoodsPO obj);|把商品信息写入数据库|
|StockDataService|public boolean delGoods(String id);|从数据库中删除对应的商品信息|
|StockDataService|public boolean modifyGoods(GoodsPO obj);|修改数据库中对应的商品信息|
|StockDataService|public GoodsPO getGoods(String id);|根据id查找商品并返回一个商品VO|
|StockDataService|public ArrayList&lt;GoodsPO> getGoods();|返回商品列表|


Classes供接口<br>

|语法|前置条件|后置条件|
|---|
|public boolean addClass(ClassVO obj);|	obj!=null|把新增商品分类信息写入数据库，若添加成功，返回true，否则返回false|
|public boolean delClass(String id);|id!=null|从数据库中删除对应的商品分类信息，若删除成功，返回true，否则返回false|
|public boolean modifyClass(ClassVO obj);|obj!=null|修改数据库中对应的商品分类信息，若修改成功，返回true，否则返回false|
|public ArrayList&lt;ClassVO> showClass();|无|返回一个记录有商品分类信息的列表|


Classes需接口<br>

|提供者|语法|功能|
|---|
|StockDataService|public boolean addClass(ClassPO obj);|把新增商品分类信息写入数据库|
|StockDataService|public boolean delClass(String id);|从数据库中删除商品分类信息|
|StockDataService|public boolean modifyClass(ClassPO obj);|修改数据库中对应的商品分类信息|
|StockDataService|public ArrayList&lt;ClassPO> showClass();|返回一个记录有商品分类信息的列表|
|StockDataService|public ArrayList&lt;ClassPO>showClass(String fatherId)|返回父类id匹配的商品分类信息列表|
|StockDataService|public ClassPO show(String id)|根据id返回商品分类信息|

|ReceiptInfo接口||
|---|
|public ArrayList&lt;ReceiptVO> readReceipt(String type,Calendar start, Calendar end)|在时间段内查找某个类型的单据|
|public ReceiptVO readReceipt(String id)|返回指定单据的详细信息|
|public ArrayList&lt;ReceiptVO> readReceipt()|返回所有单据信息|
|public boolean writeReceipt(ReceiptVO obj)|写入单据信息|
|public boolean modifyReceipt(ReceiptVO obj)|修改单据信息（总经理使用）|
|public boolean addDraft(ReceiptVO obj,String userId)|保存单据草稿|
|public boolean delDraft(String draftId,String userId)|删除单据草稿|
|public boolean modifyDraft(ReceiptVO obj,String userId)|修改单据草稿|
|public ReceiptVO readDraft(String draftId,String userId)|根据id读取草稿|
|public ArrayList&lt;ReceiptVO>readDraft(String userId)|读取所有草稿|


|GoodsInfo接口||
|---|
|public OutGoodsVO getGoods(String id);|id!=null|根据id查找商品并返回一个商品VO|
|public ArrayList&lt;OutGoodsVO> getGoods();|无|返回商品列表|
|public ArrayList&lt;OutGoodsVO> findGoods(GoodsQueryItem obj);|obj!=null|根据筛选条件返回一个记录有商品信息的列表|
|public boolean modifyGoods(OutGoodsVO obj);|修改对应的商品信息|
|public boolean addGoods(InGoodsVO obj);|新增商品信息|

|ClassInfo接口||
|---|
|public ArrayList&lt;ClassVO> showClass();|返回一个记录有商品分类信息的列表|
|public boolean addClass(ClassVO obj);|新增商品分类信息|

(4)动态模型<br>
下图表明了当用户输入了新增的商品信息后，stockbl的相关对象之间的协作
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/%E7%B1%BB%E9%A1%BA%E5%BA%8F%E5%9B%BE/addGoodsProcess.png)

下图表明当用户输入了起始时间后，stockbl进行库存查询的对象间的协作
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/%E7%B1%BB%E9%A1%BA%E5%BA%8F%E5%9B%BE/stockCheckProcess.png)

（5)度量数据

耦合度量

|类名|CBO|DAC|NOC|
|---|
|Goods|5|0|0|
|Classes|1|0|0|
|Stock|13|0|0|

聚合度量

|类名|LCOM|
|---|
|Goods|0|
|Classes|0|
|Stock|0|

### 4.1.2 clientbl模块
(1)模块描述<br>
clientbl模块承担的需求参见需求规格说明文档功能需求及相关非功能需求<br>
clientbl模块的职责及接口参见软件体系结构描述文档<br>
(2)整体结构<br>
clientbl模块的设计如下图
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/master/doc/graph/bl%E5%B1%82%E5%88%86%E8%A7%A3/Clientbl.png)

clientbl模块各个类职责如下表所示

|模块|职责|
|---|
|ClientController|负责实现客户额增删改查功能|
|Client|负责实现客户额增删改查功能|
|ClientInfo|负责向层内提供客户信息查询的服务|

(3)接口规范<br>

ClientController供接口<br>

|语法|前置条件|后置条件|
|---|
|public boolean addClient(ClientVO obj);|obj!=null|新增客户信息，若成功，返回true，否则返回false|
|public boolean delClient(String id);|id!=null|删除客户信息，若成功，返回true，否则返回false|
|public boolean modifyClient(ClientVO obj);|obj!=null|修改客户信息，若成功，返回true，否则返回false|
|public ArrayList&lt;ClientVO> searchClientbyNameTelCounterTypeLevel(String name, String tel, String counterman,
			int type, int level) ;|obj!=null|根据筛选条件返回客户信息列表|
|public ClientVO showClient(String id);|id!=null|返回相应的客户信息|
|public ArrayList&lt;ClientVO> show();|无|返回客户信息列表|

ClientController需接口<br>
同Client供接口

Client供接口<br>

|语法|前置条件|后置条件|
|---|
|public boolean addClient(ClientVO obj);|obj!=null|新增客户信息，若成功，返回true，否则返回false|
|public boolean delClient(String id);|id!=null|删除客户信息，若成功，返回true，否则返回false|
|public boolean modifyClient(ClientVO obj);|obj!=null|修改客户信息，若成功，返回true，否则返回false|
|public ArrayList&lt;ClientVO> searchClient(String name, String tel, String counterman, int type, int level);|无|根据筛选条件返回客户信息列表|
|public ClientVO showClient(String id);|id!=null|返回相应的客户信息|
|public ArrayList&lt;ClientVO> show();|无|返回客户信息列表|


Client需接口<br>

|提供者|语法|功能|
|---|
|ClientDataService|public boolean addClient(ClientPO obj);|新增客户信息|
|ClientDataService|public boolean delClient(String id);|删除客户信息|
|ClientDataService|public boolean modifyClient(ClientPO obj);修改客户信息|
|ClientDataService|public ClientPO showClient(String id);|返回相应的客户信息|
|ClientDataService|public ArrayList&lt;ClientPO> show();|返回客户信息列表|

|ClientInfo接口||
|---|
|public ClientVO showClient(String id);|返回相应的客户信息|
|public ArrayList&lt;ClientVO> show();|返回客户信息列表|
|public boolean addClient(ClientVO obj);|新增客户信息|
|public boolean modifyClient(ClientVO obj)|修改对应客户信息|

(4)动态模型<br>
下图表明了当用户输入新增客户的信息后，clientbl的相关对象间的协作
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/%E7%B1%BB%E9%A1%BA%E5%BA%8F%E5%9B%BE/addClientProcess.png)

(5)度量数据

耦合度量

|类名|CBO|DAC|NOC|
|---|
|Client|6|0|0|


聚合度量

|类名|LCOM|
|---|
|Client|0|

### 4.1.3 purchase模块
(1)模块概述<br>  
purchasebl模块承担的需求参见需求规格说明文档功能需求及相关非功能需求<br>
pruchasebl模块的职责及接口参见软件体系结构描述文档<br>
(2)模块结构<br>


purchasebl模块的设计图如下:<br>
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/bl%E5%B1%82%E5%88%86%E8%A7%A3/purchasebl%E5%88%86%E8%A7%A3.png)

purchasebl模块各个类的职责如下表所示<br>

|模块|职责|
|--|--|
|PurchaseController|实现purchaseui需要的服务，将业务分派给Purchase|
|Purchase|进货的领域模型对象，拥有一次新建进货（进货退货）单需要的客户、单据等信息，实现逻辑操作|


(3)模块内部类的接口规范

PurchaseController的接口规范:<br>
供接口:<br>

||语法|前置条件|后置条件|
|---|
|PurchaseController.showGoods|public ArrayList&lt;OutGoodsVO> showGoods_p()|已创建一个Purchase领域对象，并且输入符合输入规则|调用Purchase的showGoods方法|
|PurchaseController.showClient|public ArrayList&lt;ClientVO> showClient_p()|已创建一个Purchase领域对象，并且输入符合输入规则|调用Purchase的showClient方法|
|PurchaseController.makePurchaseReceipt|public PurchaseReceiptVO makePurchaseList(PurchaseReceiptVO obj)|已创建一个Purchase领域对象，并且输入符合输入规则|调用Purchase的makePurchaseReceipt方法|
|PurchaseController.makePurchaseReturnReceipt|public PurchaseReturnReceiptVO makePurchaseReturnList(PurchaseReturnReceiptVO obj) |已创建一个Purchase领域对象，并且输入符合输入规则|调用Purchase的makePurchaseReturneceipt方法|
|PurchaseController.showMyUnrevisedReceipts_p|public ArrayList&lt;PurchaseReceiptBothVO> showMyUnrevisedReceipts_p(String userId,int operand, Calendar startTime, Calendar endTime) |已创建一个Purchase领域对象，并且输入符合输入规则|调用Purchase的showMyUnrevisedReceipts方法|
|PurchaseController.makePurchaseReceiptDraft|public PurchaseReceiptVO makePurchaseReceiptDraft(PurchaseReceiptVO obj, String userId)|已创建一个Purchase领域对象，并且输入符合输入规则|调用Purchase的makePurchaseReceiptDraft方法|
|PurchaseController.makePurchaseReturnReceiptDraft|public PurchaseReturnReceiptVO makePurchaseReturnReceiptDraft(PurchaseReturnReceiptVO obj, String userId)|已创建一个Purchase领域对象，并且输入符合输入规则|调用Purchase的makePurchaseReturnReceiptDraft方法|
|PurchaseController.modifyPurchaseReceiptDraft|public PurchaseReceiptVO modifyPurchaseReceiptDraft(PurchaseReceiptVO obj, String userId)|已创建一个Purchase领域对象，并且输入符合输入规则|调用Purchase的modifyPurchaseReceiptDraft方法|
|PurchaseController.modifyPurchaseReturnReceiptDraft|public PurchaseReturnReceiptVO modifyPurchaseReturnReceiptDraft(PurchaseReturnReceiptVO obj, String userId)|已创建一个Purchase领域对象，并且输入符合输入规则|调用Purchase的modifyPurchaseReturnReceiptDraft方法|
|PurchaseController.showMyPurchaseReceiptDrafts|public ArrayList&lt;PurchaseReceiptVO> showMyPurchaseReceiptDrafts(String userId)|已创建一个Purchase领域对象，并且输入符合输入规则|调用Purchase的showMyPurchaseReceiptDrafts方法|
|PurchaseController.showMyPurchaseReturnReceiptDrafts|public ArrayList&lt;PurchaseReturnReceiptVO> showMyPurchaseReturnReceiptDrafts(String userId) |已创建一个Purchase领域对象，并且输入符合输入规则|调用Purchase的 showMyPurchaseReturnReceiptDrafts方法|
|PurchaseController.deleteDraft|public boolean deleteDraft_p(String draftId, String userId)|已创建一个Purchase领域对象，并且输入符合输入规则|调用Purchase的deleteDraft方法|


需接口:<br>
见Purchase供接口


Purchase的接口规范:<br>
供接口:<br>

||语法|前置条件|后置条件|
|---|--|
|Purchase.showGoods|public ArrayList&lt;OutGoodsVO> showGoods_p() |制定单据之前，从商品选择界面选择商品|返回商品列表|
|Purchase.showClient|public ArrayList&lt;ClientVO> showClient_p()|制定单据之前，从客户选择界面选择客户|返回客户列表|
|Purchase.makePurchaseReceipt|public PurchaseReceiptVO makePurchaseList(PurchaseReceiptVO obj)|obj!=null|制定进货单|
|Purchase.makePurchaseReturnReceipt|public PurchaseReturnReceiptVO makePurchaseReturnList(PurchaseReturnReceiptVO obj)|obj!=null|制定进货退货单|
|Purchase.showMyUnrevisedReceipts|public ArrayList&lt;PurchaseReceiptBothVO> showMyUnrevisedReceipts(String userId,int operand, Calendar startTime, Calendar endTime)|operand在定义范围内|查看时间段内的单据|
|Purchase.makePurchaseReceiptDraft|public PurchaseReceiptVO makePurchaseReceiptDraft(PurchaseReceiptVO obj, String userId)|obj!=null|制定进货单草稿|
|Purchase.makePurchaseReceiptDraft|public PurchaseReturnReceiptVO makePurchaseReturnReceiptDraft(PurchaseReturnReceiptVO obj, String userId)|obj!=null|制定进货退货单草稿|
|Purchase.modifyPurchaseReceiptDraft|public PurchaseReceiptVO modifyPurchaseReceiptDraft(PurchaseReceiptVO obj,String userId)|obj!=null|修改进货单草稿|
|Purchase.modifyPurchaseReceiptDraft|public PurchaseReturnReceiptVO modifyPurchaseReturnReceiptDraft(PurchaseReturnReceiptVO obj,String userId)|obj!=null|修改进货退货单草稿|

|Purchase.showMyPurchaseReceiptDrafts|public ArrayList&lt;PurchaseReceiptVO> showMyPurchaseReceiptDrafts(String userId)|userId存在|显示该用户的所有进货单草稿|
|Purchase.showMyPurchaseReturnReceiptDrafts|public ArrayList&lt;PurchaseReturnReceiptBothVO> showMyPurchaseReturnReceiptDrafts(String userId)|userId存在|显示该用户的所有进货单退货单草稿|
|Purchase.deleteDraft|public boolean deleteDraft_p(String draftId, String userId)|userId,obj!=null|删除草稿|

需接口:<br>

|服务名|服务|
|---|---|
|ReceiptInfo.addDraft(ReceiptVO obj,String userId)|保存单据草稿|
|ReceiptInfo.delDraft(String draftId,String userId)|删除单据草稿|
|ReceiptInfo.modifyDraft(ReceiptVO obj,String userId)|修改单据草稿|
|ReceiptInfo.readDraft(String draftId,String userId)|根据id读取草稿|
|ReceiptInfo.readDraft(String userId)|读取所有草稿|
|ReviseInfo.insertReceipt(ReceiptVO obj)|添加新单据至待审批区|
|ReviseInfo.showReceipt(String id)|查看待审批单据|
|ReviseInfo.showAllReceipt(userId)|查看所有待审批单据|
|GoodsInfo.getGoods()|返回所有商品的信息，包括id、商品名、单价、现有库存等，可以是String的ArrayList|
|ClientInfo.getPurchaseClient()|返回所有的客户(卖给我们东西的客户)的信息，包括客户姓名、联系方式等|


(4)业务逻辑层的动态模型<br>
下图表明了在本系统中，当用户输入单据信息新建进货单后，purchase业务逻辑相关对象之间的协作。<br>
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/%E7%B1%BB%E9%A1%BA%E5%BA%8F%E5%9B%BE/Purchasebl%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)

(5)耦合度量

|类名|指标|  |||
|--|--|  
||CBO|DAC|NOC|DIT|
|Purchase|9|4|0|0||


(6)内聚度量

|类名|LCOM|  
|--|--|  
|Purchase|0|

### 4.1.4 sale模块
(1)模块概述<br>  
salebl模块承担的需求参见需求规格说明文档功能需求及相关非功能需求<br>
salebl模块的职责及接口参见软件体系结构描述文档<br>

(2)模块结构<br>

salebl模块的设计图如下:<br>
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/bl%E5%B1%82%E5%88%86%E8%A7%A3/salebl%E5%88%86%E8%A7%A3.png)

salebl模块各个类的职责如下表:<br>

|模块|职责|
|--|--|
|SaleController|实现saleui所需要的服务|
|Sale|销售的领域模型对象，包含新建销售（销售退货）单需要的单据等信息，提供相关服务|

(3)模块内部类的接口规范

SaleController的接口规范:<br>
供接口:<br>

||语法|前置条件|后置条件|
|---|
|SaleController.showGoods|public ArrayList&lt;OutGoodsVO> showGoods()|已创建一个Sale领域模型对象，且输入符合输入规则|调用Sale领域对象的showGoods方法|
|SaleController.showClient|public ArrayList&lt;ClientVO> showClient()|已创建一个Sale领域模型对象，且输入符合输入规则|调用Sale领域对象的showClient方法|
|SaleController.makeSaleReceipt|public SaleReceiptVO makeSaleReceipt(SaleReceiptVO obj)|已创建一个Sale领域模型对象，且输入符合输入规则|调用Sale领域对象的makeSaleReceipt方法|
|SaleController.makeSaleReturnReceipt|public SaleReturnReceiptVO makeSaleReturnReceipt(SaleReturnReceiptVO obj)|已创建一个Sale领域模型对象，且输入符合输入规则|调用Sale领域对象的makeSaleReturnReceipt方法|
|SaleController.chooseGiftStrategy|public StockGiftReceiptVO chooseGiftStrategy(String strategyId,String userId,SaleReceiptBothVO receipt) |已创建一个Sale领域模型对象，且输入符合输入规则|调用Sale领域对象的chooseGiftStrategy方法|
|SaleController.chooseOtherStrategy|public boolean chooseOtherStrategy(String strategyId,String userId,SaleReceiptBothVO receipt)|已创建一个Sale领域模型对象，且输入符合输入规则|调用Sale领域对象的chooseOtherStrategy方法|
|SaleController.showMyUnrevisedReceipts|public ArrayList&lt;SaleReceiptBothVO> showMyUnrevisedReceipts(String userId,int operand, Calendar startTime, Calendar endTime)|已创建一个Sale领域模型对象，且输入符合输入规则|调用Sale领域对象的showMyUnrevisedReceipts方法|
|SaleController.showValidStrategy|public ArrayList&lt;StrategyVO> showValidStrategy(SaleReceiptBothVO saleReceipt)|已创建一个Sale领域模型对象，且输入符合输入规则|调用Sale领域对象的showValidStrategy方法|
|SaleController.makeSaleReceiptDraft|public SaleReceiptVO makeSaleReceiptDraft(SaleReceiptVO obj,String userId)|已创建一个Sale领域对象，并且输入符合输入规则|调用Sale的makeSaleReceiptDraft方法|
|SaleController.makeSaleReceiptDraft|public SaleReturnReceiptVO makeSaleReturnReceiptDraft(SaleReturnReceiptVO obj,String userId)|已创建一个Sale领域对象，并且输入符合输入规则|调用Sale的makeSaleReturnReceiptDraft方法|
|SaleController.modifySaleReceiptDraft|public SaleReceiptVO modifySaleReceiptDraft(SaleReceiptVO obj,String userId)|已创建一个Sale领域对象，并且输入符合输入规则|调用Sale的modifySaleReceiptDraft方法|
|SaleController.modifySaleReceiptDraft|public SaleReturnReceiptVO modifySaleReturnReceiptDraft(SaleReturnReceiptVO obj,String userId)|已创建一个Sale领域对象，并且输入符合输入规则|调用Sale的modifySaleReturnReceiptDraft方法|
|SaleController.showMySaleReceiptDrafts|public ArrayList&lt;SaleReceiptVO> showMySaleReceiptDrafts(String userId)|已创建一个Sale领域对象，并且输入符合输入规则|调用Sale的showMySaleReceiptDrafts方法|
|SaleController.showMySaleReturnReceiptDrafts|public ArrayList&lt;SaleReturnReceiptVO> showMySaleReturnReceiptDrafts(String userId)|已创建一个Sale领域对象，并且输入符合输入规则|调用Sale的 showMySaleReturnReceiptDrafts方法|
|SaleController.deleteDraft|public boolean deleteDraft(String draftId,String userId)|已创建一个Sale领域对象，并且输入符合输入规则|调用Sale的deleteDraft方法|
|SaleController.getStrategyById|public StrategyVO getStrategyById(String id)|已创建一个Sale领域对象，并且id对应策略存在|调用Sale的getStrategyById方法|
|SaleController.makeGiftReceipt|makeGiftReceipt(StockGiftReceiptVO receipt))|已创建一个Sale领域对象，并且receipt!=null|调用Sale的makeGiftReceipt方法|

需接口:<br>
见Sale的供接口  

Sale的接口规范:<br>  

供接口:<br>

||语法|前置条件|后置条件|
|---|
|Sale.showGoods|public ArrayList&lt;OutGoodsVO> showGoods()|制定单据之前，从商品选择界面选择商品|返回商品列表|
|Sale.showClient|public ArrayList&lt;ClientVO> showClient()|制定单据之前，从客户选择界面选择客户|返回客户列表|
|Sale.makeSaleReceipt|public SaleReceiptVO makeSaleReceipt(SaleReceiptVO obj)|obj!=null|制定销售单,保存并返回该单据|
|Sale.makeSaleReturnReceipt|public SaleReturnReceiptVO makeSaleReturnReceipt(SaleReturnReceiptVO obj)|obj!=null|制定销售退货单,保存并返回该单据|
|Sale.chooseGiftStrategy|public StockGiftReceiptVO chooseGiftStrategy(String strategyId,String userId,SaleReceiptBothVO receipt) |存在相应id的赠品策略|选择了赠品销售策略，生成库存赠送单，保存并返回|
|Sale.chooseOtherStrategy|public boolean chooseOtherStrategy(String strategyId,String userId,SaleReceiptBothVO receipt)|存在相应id的非赠品策略|更改销售单的属性|
|Sale.showValidStrategy|public ArrayList&lt;StrategyVO> showValidStrategy(SaleReceiptBothVO saleReceipt)|saleReceipt!=null|返回合适的策略，调用strategyInfo的方法|
|Sale.showMyUnrevisedReceipts|public ArrayList&lt;SaleReceiptBothVO> showMyUnrevisedReceipts(String userId,int operand, Calendar startTime, Calendar endTime)|operand在定义范围内|根据operand导出销售(1)、销售退货(2)信息|
|Sale.makeSaleReceiptDraft|public SaleReceiptVO makeSaleReceiptDraft(SaleReceiptVO obj,String userId)|userId,obj!=null|制定销售单草稿|
|Sale.makeSaleReceiptDraft|public SaleReturnReceiptVO makeSaleReturnReceiptDraft(SaleReturnReceiptVO obj,String userId)|userId,obj!=null|制定销售退货单草稿|
|Sale.showMySaleReceiptDrafts|public ArrayList&lt;SaleReceiptVO> showMySaleReceiptDrafts(String userId) |userId存在|显示所有销售单草稿|
|Sale.showMySaleReturnReceiptDrafts|public ArrayList&lt;SaleReturnReceiptVO> showMySaleReturnReceiptDrafts(String userId)|userId存在|显示所有销售退货单草稿|
|Sale.modifySaleReceiptDraft|public SaleReceiptVO modifySaleReceiptDraft(SaleReceiptVO obj,String userId)|userId,obj!=null|修改销售单草稿|
|Sale.modifySaleReceiptDraft|public SaleReturnReceiptVO modifySaleReturnReceiptDraft(SaleReturnReceiptVO obj,String userId)|userId,obj!=null|修改销售退货单草稿|
|Sale.deleteDraft|public boolean deleteDraft(String draftId,String userId)|userId,obj!=null|删除草稿|
|Sale.getStrategyById|public StrategyVO getStrategyById(String id)|id对应的策略存在|读取销售策略|
|Sale.makeGiftReceipt|public boolean makeGiftReceipt(StockGiftReceiptVO receipt)|receipt!=null|提交库存赠送单到待审批区|


需接口:<br>

|服务名|服务|
|---|---|
|ReceiptInfo.addDraft(ReceiptVO obj,String userId)|保存单据草稿|
|ReceiptInfo.delDraft(String draftId,String userId)|删除单据草稿|
|ReceiptInfo.modifyDraft(ReceiptVO obj,String userId)|修改单据草稿|
|ReceiptInfo.readDraft(String draftId,String userId)|根据id读取草稿|
|ReceiptInfo.readDraft(String userId)|读取所有草稿|
|ReviseInfo.insertReceipt(ReceiptVO obj)|添加新单据至待审批区|
|ReviseInfo.showReceipt(String id)|查看待审批单据|
|ReviseInfo.showAllReceipt(userId)|查看所有待审批单据|
|GoodsInfo.getGoods()|返回所有商品的信息，包括id、商品名、单价、现有库存等，可以是String的ArrayList|
|ClientInfo.getPurchaseClient()|返回所有的客户(卖给我们东西的客户)的信息，包括客户姓名、联系方式等|
|StrategyInfo.adviceStrategy(SaleReceiptPO saleReceipt)|返回符合要求的ArrayList&lt;StrategyPO>|
|StrategyInfo.getStrategyById(id)|返回id对应的促销策略|


(4)业务逻辑层的动态模型<br>
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/%E7%B1%BB%E9%A1%BA%E5%BA%8F%E5%9B%BE/Salebl%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)

(5)耦合度量

|类名|指标|  |||
|--|--|  
||CBO|DAC|NOC|DIT|
|Sale|11|5|0|0||


(6)内聚度量

|类名|LCOM|  
|--|--|  
|Sale|0|


### 4.1.5 account模块
(1)模块概述<br>  
accountbl模块承担的需求参见需求规格说明文档功能需求及相关非功能需求<br>
accountbl模块的职责及接口参见软件体系结构描述文档<br>

(2)模块结构<br>

accountbl模块的设计图如下:<br>
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/master/doc/graph/bl%E5%B1%82%E5%88%86%E8%A7%A3/accountbl%E5%88%86%E8%A7%A3.png)

accountbl模块各个类的职责如下表:<br>

|模块|职责|
|--|--|
|AccountController|负责实现accountui需要的服务|
|Account|account领域的模型对象，拥有账户等信息和相应的服务|

(3)模块内部接口规范

AccountController的接口规范:<br>

供接口：

||语法|前置条件|后置条件|
|---|
|AccountController.addAccount|public AccountVO addAccount(AccountVO obj);|已创建一个Account领域对象，且输入符合输入规则|调用Account的addAccount方法|
|AccountController.findAccount|public AccountVO findAccount(String id);|已创建一个Account领域对象，且输入符合输入规则|调用Account的findAccount方法|
|AccountController.getAccounts|public ArrayList&lt;AccountVO> getAccounts()|已创建一个Account领域对象|调用Account的getAccounts方法|
|AccountController.deleteAccount|public boolean deleteAccount(String accountId);|已创建一个Account领域对象，且输入符合输入规则|调用Account的deleteAccount方法|
|AccountController.login|public boolean login(String id,String password);|已创建一个Account领域对象，且输入符合输入规则|调用Account的login方法|
|AccountController.updateAccount|public boolean updateAccount(AccountVO obj);|已创建一个Account领域对象，且输入符合输入规则|调用Account的updateAccount方法|
|AccountController.updateBalance|public boolean updateBalance(String accountId,double difference);|已创建一个Account领域对象，且输入符合输入规则|调用Account的updateBalance方法|
|AccountController.checkUserLevel|public boolean checkUserLevel(String userId)|已创建一个Account领域对象，且输入符合输入规则|调用Account的checkUserLevel方法|

需接口：<br>
见Account类的供接口


Account类的接口规范:<br>
供接口:<br>

||语法|前置条件|后置条件|
|---|
|Account.addccount|public AccountVO addAccount(AccountVO obj);|obj!=null|增加一个银行账户并返回|
|Account.findAccount|public AccountVO findAccountById(String id);|id!=null|根据id查找一个账户，找不到返回null|
|Account.findAccount|public AccountVO findAccountByNickname(String nickname);|nickname!=null|根据nickname查找一个账户，找不到返回null|
|Account.deleteccount|public boolean deleteAccount(String accountId);|accountId!=null|删除一个账户，删除成功返回true|
|Account.updateAccount|public boolean updateAccount(AccountVO obj);|obj!=null|更新账户信息，用于修改密码、昵称等操作，与balance修改区别使用|
|Account.updateBalance|public boolean updateBalance(String accountId,double difference);|存在账户,修改后的balance值大于等于0|更新账户balance|
|Account.login|public boolean login(String id,String password);|id,password!=null|先根据id查询账户是否存在，然后检验password是否匹配，若匹配，则返回true,否则返回false|
|Account.checkUserLevel|public boolean checkUserLevel(String userId)|id!=null|若用户等级符号要求返回true，否则返回false|
|AccountInfo.showAccounts|public ArrayList&lt;String> showAccounts();|无（层内调用）|返回所有账户的昵称|
|AccountInfo.addAccountWhenBook|public AccountVO addAccountWhenBook(AccountVO obj)|（层内调用）obj!=null,不需要权限的增加银行账户，仅供期初建账时使用|增加一个银行账户|
|AccountInfo.getAccounts|public ArrayList&lt;AccountVO> getAccounts()|返回所有账户的vo|

需接口：<br>

|服务名|服务|
|--|--|
|AccountDataService.add(AccountPO account)|新建一个账户|
|AccountDataService.delete(AccountPO account)|删除一个账户|
|AccountDataService.updateAccount(AccountPO account)|更新一个账户|
|AccountDataService.updateBalance(String accountId,double newBalance)|更新一个账户的余额|
|AccountDataService.findByNickname(String nickname)|查找一个账户|
|AccountDataService.showAll()|返回账户po列表|
|AccountDataService.findById(String id)|查找一个账户|
|UserInfo.getUserLevel(String id)|返回客户的等级|


(4)业务逻辑层动态模型<br>
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/master/doc/graph/%E7%B1%BB%E9%A1%BA%E5%BA%8F%E5%9B%BE/accountbl%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)


(5)耦合度量

|类名|指标|  |||
|--|--|  
||CBO|DAC|NOC|DIT|
|Account|12|2|0|0||


(6)内聚度量

|类名|LCOM|  
|--|--|  
|Account|0|


### 4.1.6 finance模块
(1)模块概述  
finance模块承担的需求参见需求规格说明文档功能需求及相关非功能需求<br>
finance模块的职责及接口参见软件体系结构描述文档<br>

(2)模块结构<br>
finance模块的设计图如下:
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/bl%E5%B1%82%E5%88%86%E8%A7%A3/finance%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1.png)

financebl模块各个类的职责如下表所示

|模块|职责|
|---|
|FinanceController|负责对应financeui需要的服务|
|Finance|Finance领域的模型对象，拥有客户信息和银行账户信息，帮助完成financeui需要的服务|

(3)模块内部类的接口规范
FinanceController的接口规范：  
供接口：  

||语法|前置条件|后置条件|
|---|
|FinanceController.showClients|public ArrayList&lt;ClientVO> showClients()|已创建一个Finance领域对象|返回已有的客户列表|
|FinanceController.showAccounts|public ArrayList&lt;String> showAccounts()|已创建一个Finance领域对象|返回已有的银行账户列表|
|FinanceController.getAccount|public AccountVO getAccount(String nickName)|存在nickName对应的账户|返回nickName对应的账户vo|
|FinanceController.makeCashReceipt|public boolean makeCashReceipt(FinanceCashReceiptVO cashReceipt);|已创建一个Finance领域对象,cashReceipt!=null|制定一个现金费用单|
|FinanceController.makePayReceipt|public boolean makePayReceipt(FinancePayReceiptVO payReceipt);|已创建一个Finance领域对象,payReceipt!=null|制定一个付款单|
|FinanceController.makeCollectReceipt|public boolean makeCollectReceipt(FinanceCollectReceiptVO collectReceipt);|已创建一个Finance领域对象,collectReceipt!=null|制定一个收款单|
|FinanceController.readRevisedReceiptList|public ArrayList&lt;ReceiptVO> readRevisedReceiptList(String userId)|已创建一个Finance领域对象，userid!=null|返回最近七天本userid的已审批单据|
|FinanceController.readReceipt|public ReceiptVO ReadReceipt(String receiptID)|已创建一个Finance领域对象,且存在该id对应单据|读取一个审批通过的单据详细信息|
|FinanceController.readUnrevisedReceiptList|public ArrayList&lt;ReceiptVO> readUnrevisedReceiptList(String userId)|已创建一个Finance领域对象，userid!=null|返回该user提交的未审批单据列表|
|FinanceController.readUnrevisedReceipt|public ReceiptVO readUnrevisedReceipt(String receiptID)|已创建一个Finance领域对象，且存在该id对应单据|返回该user提交的未审批单据详细信息|
|FinanceController.addDraft|public boolean addDraft(ReceiptVO receipt)|已创建一个Finance领域对象,receipt!=null|保存草稿|
|FinanceController.modifyDraft|public boolean modifyDraft(ReceiptVO receipt)|已创建一个Finance领域对象,receipt!=null|修改草稿|
|FinanceController.delDraft|public boolean delDraft(ReceiptVO receipt，String userId)|已创建一个Finance领域对象,receipt!=null|删除草稿|

|FinanceController.readDraftList|public ArrayList&lt;ReceiptVO> readDraftList(String userId)|已创建一个Finance领域对象，userid!=null|返回该user的草稿列表|
|FinanceController.readDraft|public ReceiptVO readDraft(String receiptId，String userId)|已创建一个Finance领域对象，userid!=null|返回该id对应的草稿详细信息|

需接口：

见Finance模块供接口


Finance的接口规范：  
供接口：

||语法|前置条件|后置条件|
|---|
|Finance.showClients|public ArrayList&lt;ClientVO> showClients()|无|返回已有的客户列表|
|Finance.showAccounts|public ArrayList&lt;String> showAccounts()|无|返回已有的银行账户列表|
|Finance.getAccount|public AccountVO getAccount(String nickName)|存在nickName对应的账户|返回nickName对应的账户vo|
|Finance.makeCashReceipt|public boolean makeCashReceipt(FinanceCashReceiptVO cashReceipt);|cashReceipt!=null|制定一个现金费用单|
|Finance.makePayReceipt|public boolean makePayReceipt(FinancePayReceiptVO payReceipt);|payReceipt!=null|制定一个付款单|
|Finance.makeCollectReceipt|public boolean makeCollectReceipt(FinanceCollectReceiptVO collectReceipt);|collectReceipt!=null|制定一个收款单|
|Finance.readRevisedReceiptList|public ArrayList&lt;ReceiptVO> readRevisedReceiptList(String userid)|userid!=null|返回最近七天本userid的已审批单据|
|Finance.readReceipt|public ReceiptVO ReadReceipt(String receiptID)|存在该id对应单据|读取一个审批通过的单据详细信息|
|Finance.readUnrevisedReceiptList|public ArrayList&lt;ReceiptVO> readUnrevisedReceiptList(String userid)|userid!=null|返回该user提交的未审批单据列表|
|Finance.readUnrevisedReceipt|public ReceiptVO readUnrevisedReceipt(String receiptID)|存在该id对应单据|返回该user提交的未审批单据详细信息|
|Finance.addDraft|publice boolean addDraft(ReceiptVO receipt)|receipt!=null|保存草稿|
|Finance.modifyDraft|publice boolean modifyDraft(ReceiptVO receipt)|receipt!=null|修改草稿|
|Finance.delDraft|publice boolean delDraft(ReceiptVO receipt，String userid)|receipt!=null|删除草稿|

|Finance.readDraftList|public ArrayList&lt;ReceiptVO> readDraftList(String userid)|userid!=null|返回该user的草稿列表|
|Finance.readDraft|public ReceiptVO readDraft(String Receiptid，String userid)|userid!=null|返回该id对应的草稿详细信息|

需接口：

|服务名|服务|
|---|---|
|ClientInfo.showClients()|返回客户信息PO列表|
|AccountInfo.showAccounts()|银行账户信息String列表|
|AccountInfo.findAccountByNickname()|根据昵称查找银行账户|
|ReceiptInfo.readReceipt(String receiptID)|返回单据编号吻合的单据对象|
|ReceiptInfo.addDraft(ReceiptVO obj,String userId)|保存单据草稿|
|ReceiptInfo.delDraft(String draftId,String userId)|删除单据草稿|
|ReceiptInfo.modifyDraft(ReceiptVO obj,String userId)|修改单据草稿|
|ReceiptInfo.readDraft(String draftId,String userId)|根据id读取草稿|
|ReceiptInfo.readDraft(String userId)|读取所有草稿|
|ReviseInfo.insertReceipt(ReceiptVO obj)|推送待审批单据|
|ReviseInfo.showReceipt(String id)|查看待审批单据|
|ReviseInfo.showAllReceipt(userId)|查看所有待审批单据|

(4)业务逻辑层动态模型<br>
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/%E7%B1%BB%E9%A1%BA%E5%BA%8F%E5%9B%BE/financebl%E9%A1%BA%E5%BA%8F%E5%9B%BE_%E5%88%9B%E5%BB%BA%E6%94%B6%E6%AC%BE%E5%8D%95.png)

(5)耦合度量

|类名|指标|  |||
|--|--|  
||CBO|DAC|NOC|DIT|
|Finance|12|3|0|0||


(6)内聚度量

|类名|LCOM|  
|--|--|  
|Finance|0|

### 4.1.7 form模块
(1)模块概述  
form模块承担的需求参见需求规格说明文档功能需求及相关非功能需求<br>
form模块的职责及接口参见软件体系结构描述文档<br>

(2)模块结构<br>
form模块的设计图如下：
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/bl%E5%B1%82%E5%88%86%E8%A7%A3/formbl%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1.png)

formbl模块各个类的职责如下表所示

|模块|职责|
|---|
|FormController|负责对应formui需要的服务|
|Form|Form领域的模型对象，拥有大量单据信息,帮助完成formui需要的服务|

(3)模块内部类的接口规范
FormController的接口规范：  
供接口：  

||语法|前置条件|后置条件|
|---|
|FormController.saleList|public ArrayList&lt;SaleFormLineItem> saleList(Calendar beginTime,Calendar endTime,String condition);|已创建一个form领域对象且condition!=null|根据筛选条件查看销售明细表|
|FormController.recordList|public ArrayList&lt;ReceiptVO> recordList(Calendar beginTime,Calendar endTime,String condition);|已创建一个form领域对象且condition!=null|根据筛选条件查看经营历程表|
|FormController.showDetailReceipt|public ReceiptVO showDetailReceipt(String id);|已创建一个form领域对象，且数据库中存在id对应单据|显示选中的单据详细信息|
|FormController.offset|public boolean offset(ReceiptVO receipt);|已创建一个form领域对象且receipt!=null|创建一个数量取负的红冲单据|
|FormController.offsetAndCopy|public boolean offsetAndCopy(ReceiptVO offSetReceipt);|已创建一个form领域对象且offSetReceipt!=null|创建一个修改模式的红冲单据|
|FormController.businessList|public Double[] businessList(Calendar beginTime,Calendar endTime);|已创建一个form领域对象，起始时间start在结束时间end之前|根据时间区间查看经营情况表|


需接口：

|服务名|服务|
|---|---|
|Form.saleList(Calendar beginTime,Calendar endTime,String condition);|根据筛选条件查看销售明细表|
|Form.recordList(Calendar beginTime,Calendar endTime,String condition);|根据筛选条件查看经营历程表|
|Form.showDetailReceipt(String id);|显示选中的单据详细信息|
|Form.offset(ReceiptVO receipt);|创建一个数量取负的红冲单据|
|Form.offsetAndCopy(ReceiptVO offSetReceipt);|创建一个修改模式的红冲单据|
|Form.businessList(Calendar beginTime,Calendar endTime);|根据时间区间查看经营情况表|



Form的接口规范：  
供接口：

||语法|前置条件|后置条件|
|---|
|Form.saleList|public ArrayList&lt;SaleFormLineItem> saleList(Calendar beginTime,Calendar endTime,String condition);|condition!=null|根据筛选条件查看销售明细表|
|Form.recordList|public ArrayList&lt;ReceiptVO> recordList(Calendar beginTime,Calendar endTime,String condition);|condition!=null|根据筛选条件查看经营历程表|
|Form.showDetailReceipt|public ReceiptVO showDetailReceipt(String id);|数据库中存在id对应单据|显示选中的单据详细信息|
|Form.offset|public boolean offset(ReceiptVO receipt);|receipt!=null|创建一个数量取负的红冲单据|
|Form.offsetAndCopy|public boolean offsetAndCopy(ReceiptVO offSetReceipt);|offSetReceipt!=null|创建一个修改模式的红冲单据|
|Form.businessList|public Double[] businessList(Calendar beginTime,Calendar endTime);|起始时间start在结束时间end之前|根据时间区间查看经营情况表|

需接口：

|服务名|服务|
|---|---|
|ReceiptInfo.writeReceipt(ReceiptVO obj)|制定一个单据|
|ReceiptInfo.readReceipt(int type,Calendar start, Calendar end)|在时间段内查找某个类型的单据|
|ReceiptInfo.readReceipt(String id)|返回指定单据的详细信息|

(4)业务逻辑层动态模型<br>
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/%E7%B1%BB%E9%A1%BA%E5%BA%8F%E5%9B%BE/formbl%E9%A1%BA%E5%BA%8F%E5%9B%BE_%E6%9F%A5%E7%9C%8B%E9%94%80%E5%94%AE%E6%98%8E%E7%BB%86%E8%A1%A8.png)

(5)耦合度量

|类名|指标|  |||
|--|--|  
||CBO|DAC|NOC|DIT|
|Form|9|1|0|0||


(6)内聚度量

|类名|LCOM|  
|--|--|  
|Form|0|

### 4.1.8 book模块
(1)模块概述   
book模块承担的需求参见需求规格说明文档功能需求及相关非功能需求<br>
book模块的职责及接口参见软件体系结构描述文档<br>

(2)模块结构<br>
book模块的设计图如下
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/bl%E5%B1%82%E5%88%86%E8%A7%A3/bookbl%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1.png)

bookbl模块各个类的职责如下表所示

|模块|职责|
|---|
|BookController|负责对应bookui需要的服务|
|Book|Book领域的模型对象，拥有商品信息，客户信息，银行账户信息,帮助完成bookui需要的服务|

(3)模块内部类的接口规范
BookController的接口规范：  
供接口：  

||语法|前置条件|后置条件|
|---|
|BookController.initBook|public void initBook();|已创建一个book领域对象|根据给定信息新建一套账目|
|BookController.saveDraft|public void saveDraft();|已创建一个book领域对象|保存当前草稿|
|BookController.cancelChange|public void cancelChange();|已创建一个book领域对象|取消当前更改|
|BookController.showBook|public BookVO showBook();|已创建一个book领域对象|展示期初账目信息|
|BookController.getNow|public BookVO getNow()|已创建一个book领域对象|返回当前账目状态|
|BookController.creatingBook|public void creatingBook()|已创建一个book领域对象|进入建账状态|


需接口：
见Book供接口

Book的接口规范：  
供接口：

||语法|前置条件|后置条件|
|---|
|Book.initBook|public void initBook();|无|根据给定信息新建一套账目|
|Book.saveDraft|public void saveDraft();|无|保存当前草稿|
|Book.cancelChange|public void cancelChange();|无|取消当前更改|
|Book.showBook|public BookVO showBook();|无|展示期初账目信息|
|Book.getNow|public BookVO getNow()|无|返回当前账目状态|
|Book.creatingBook|public void creatingBook()|无|进入建账状态|

需接口：

|服务名|服务|
|---|---|
|BookDataService.initBook(BookPO book)|根据给定信息新建一套账目|
|BookDataService.saveDraft()|保存账目草稿|
|BookDataService.cancelChange())|丢弃当前更改|
|BookDataService.showBook()|返回期初账目|
|BookDataService.creatingBook()|进入建账状态|
|ClientInfo. show()|获取客户列表|
|ClassInfo.showClass()|获取商品列表|
|GoodsInfo.getGoods()|获取商品列表|
|Account.getAccounts()|获取银行账户列表|


(4)业务逻辑层动态模型<br>
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/%E7%B1%BB%E9%A1%BA%E5%BA%8F%E5%9B%BE/bookbl%E9%A1%BA%E5%BA%8F%E5%9B%BE_%E6%96%B0%E5%BB%BA%E4%B8%80%E5%A5%97%E8%B4%A6%E7%9B%AE.png)

(5)耦合度量

|类名|指标|  |||
|--|--|  
||CBO|DAC|NOC|DIT|
|Book|13|6|0|0||


(6)内聚度量

|类名|LCOM|  
|--|--|  
|Book|0|


### 4.1.9 revisebl模块
(1)模块描述<br>
revisebl模块承担的需求参见需求规格说明文档功能需求及相关非功能需求<br>
revisebl模块的职责及接口参见软件体系结构描述文档<br>
(2)整体结构<br>
根据体系结构设计采用分层风格，将系统分为展示层，业务逻辑层，数据层。每一层之间为了灵活性，添加了接口，以实现针对接口编程，隔离数据传输的职责，降低层与层之间耦合，添加了businesslogicservice.reviseblservice.ReviseBLService接口。为了隔离业务逻辑职责和逻辑控制职责，我们添加了ReviseController，这样ReviseController将会实现界面层相关的业务逻辑职责。ReceiptReader对象用于从数据层中读取ReceiptPO，由接口businesslogicservice.receiptreaderbl.ReceiptReader提供。ReceiptPO是作为管理信息的持久化对象添加入设计模型的。
revise模块的设计如下图
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/master/doc/graph/bl%E5%B1%82%E5%88%86%E8%A7%A3/revisebl%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1.png)
<br>revisebl模块的各个类的职责如下表所示

|模块|职责|
|---|---|
|Revise|审批单据的领域模型对象，负责审批单据方面的功能|
|ReviseController|负责实现审批单据界面所需要的方法|
(3)模块内部类的接口规范

ReviseController的接口规范如下表
#### 3.1 供接口

||语法|前置条件|后置条件|
|---|---|----|
|ReviseController.showAllReceipt|public ArrayList&lt;ReceiptVO> showAllReceipt(String Userid)|无|展示单据列表|
|ReviseController.showReceipt|public ReceiptVO showReceipt(String id);|id!=null|根据单据编号查找单据，返回单据信息|
|ReviseController.revise|public boolean revise(ReceiptVO receiptVO,int operand);|obj!=null|审批单一单据|
|ReviseController.updateReceipt|public boolean updateReceipt(ReceiptVO r);|r!=null|修改单据|

#### 3.2 需接口

|服务名|服务|
|---|----|
|Revise.showAllReceipt()|展示单据列表|
|Revise.ReceiptVO showReceipt(String id)|根据单据编号查找单据，返回单据信息|
|Revise.revise(ReceiptVO obj)|审批单一单据|
|Revise.public boolean update(ReceiptVO r)|修改单据|

Revise的接口规范如下表

#### 3.1 供接口

||语法|前置条件|后置条件|
|---|---|----|
|Revise.showAllReceipt|public ArrayList&lt;ReceiptVO> showAllReceipt(String userId)|无|展示单据列表|
|Revise.showReceipt|public ReceiptVO showReceipt(String id);|id!=null|根据单据编号查找单据，返回单据信息|
|Revise.revise|public boolean revise(ReceiptVO receiptVO,int operand)|obj!=null|审批单一单据|
|Revise.update|public boolean update(ReceiptVO r)|obj!=null|修改单据内容|
|ReviseInfo.insertReceipt|public boolean insertReceipt(ReceiptVO obj)|obj!=null|将一个单据加入待审批区|

#### 3.2 需接口

|服务名|服务|
|---|---|
|ReviseData.finds()|返回未审批单据列表|
|ReviseData.find(String id)|根据id查找未审批单据信息|
|ReviseData.update(ReceiptPO r)|更新未审批单据|
|ReviseData.add(ReceiptPO r)|添加未审批单据|
|ReviseData.delete(String id)|删除未审批单据|
|ReceiptInfo.writeReceipt(ReceiptVO obj)|将审批后的单据写入数据库|
|ReceiptInfo.addDraft(ReceiptVO obj,String userId)|审批不通过的单据写入草稿箱|
|GoodsInfo.modifyGoods(GoodsVO obj)|修改数据库中对应的商品信息，若修改成功，返回true，否则返回false|
|AccountInfo.updateAccountBalance(String accountId,double difference)|更新账户余额|
|ClientInfo.modifyClient(ClientVO obj)|更新客户应收应付|




(4)revisebl模块的动态模型<br>
审批单个单据的顺序图如下<br>
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/%E7%B1%BB%E9%A1%BA%E5%BA%8F%E5%9B%BE/%E5%AE%A1%E6%89%B9%E5%8D%95%E4%B8%AA%E5%8D%95%E6%8D%AE%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)

### 4.1.10 strategybl模块
(1)模块描述<br>
strategybl模块承担的需求参见需求规格说明文档功能需求及相关非功能需求<br>
strategybl模块的职责及接口参见软件体系结构描述文档<br>
(2)整体结构<br>
根据体系结构设计采用分层风格，将系统分为展示层，业务逻辑层，数据层。每一层之间为了灵活性，添加了接口，以实现针对接口编程，隔离数据传输的职责，降低层与层之间耦合，添加了businesslogicservice.strategyblservice.StrategyBLService接口。为了隔离业务逻辑职责和逻辑控制职责，我们添加了StrategyController，这样StrategyController将会实现界面层相关的业务逻辑职责。Client和Goods对象用于承载商品和客户的信息，由接口businesslogicservice.stockbl.Goods和businesslogicservice.clientbl.Client提供。Strategy是促销策略的领域模型对象。StrategyPO是作为管理信息的持久化对象添加入设计模型的。

strategy模块的设计如下图
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/wulinyang/doc/graph/bl%E5%B1%82%E5%88%86%E8%A7%A3/strategybl%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1.png)
<br>strategybl模块的各个类的职责如下表所示

|模块|职责|
|---|---|
|Strategy|促销策略的领域模型对象，负责促销策略的增删改查以及提供建议促销策略方面的功能|
|StrategyController|负责实现促销策略界面所需要的方法|

(3)接口规范
<br>StrategyController的接口规范如下表

#### 3.1 供接口
||语法|前置条件|后置条件|
|---|
|StrategyController.showAllStrategy|public ArrayList&lt;StrategyVO> findAllStrategy();|无|展示已有的促销策略列表|
|StrategyController.findStrategy|public StrategyVO findStrategy(String id);|无|展示选中的促销策略的详细信息|
|StrategyController.makeStrategy|public void makeStrategy(StrategyVO obj);|obj!=null|制定新的促销策略|
|StrategyController.removeStrategy|public void removeStrategy(String id);|id!=null|删除原有的促销策略|

#### 3.2 需接口

|服务名|服务|
|---|---|
|Strategy.findAllStrategy()|展示已有的促销策略列表|
|Strategy.getStrategyById(String id)|展示选中的促销策略的详细信息|
|Strategy.makeStrategy(StrategyVO obj)|制定新的促销策略|
|Strategy.removeStrategy(String id)|删除原有的促销策略|

Strategy的接口规范如下表

#### 3.1 供接口
||语法|前置条件|后置条件|
|---|
|Strategy.findAllStrategy|public ArrayList&lt;StrategyVO> findAllStrategy();|无|展示已有的促销策略列表|
|Strategy.getStrategyById|public StrategyVO getStrategyById(String id);|无|展示选中的促销策略的详细信息|
|Strategy.makeStrategy|public void makeStrategy(StrategyVO obj);|obj!=null|制定新的促销策略|
|Strategy.removeStrategy|public void removeStrategy(String id);|id!=null|删除原有的促销策略|
|Strategy.adviseStrategy|public ArrayList&lt;StrategyVO> adviseStrategy(ReceiptVO obj);|obj!=null|根据销售单据提供可使用的促销策略|

#### 3.2 需接口
|服务名|服务|
|---|---|
|StrategyDataService.insert(StrategyPO strategy)|插入新的单一持久化对象|
|StrategyDataService.update(StrategyPO strategy)|删除单一持久化对象|
|StrategyDataService.delete(StrategyPO strategy)|更新单一持久化对象|
|StrategyDataService.finds()|查找多个持久化对象|
|StrategyDataService.find(int id)|查找单一持久化对象|
|ClientInfo.showClient(String id)|返回一个客户VO|

(4)strategybl模块的动态模型<br>
新增促销策略的顺序图如下<br>
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/wulinyang/doc/graph/%E7%B1%BB%E9%A1%BA%E5%BA%8F%E5%9B%BE/%E6%96%B0%E5%A2%9E%E4%BF%83%E9%94%80%E7%AD%96%E7%95%A5%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)
删除促销策略的顺序图如下<br>
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/wulinyang/doc/graph/%E7%B1%BB%E9%A1%BA%E5%BA%8F%E5%9B%BE/%E5%88%A0%E9%99%A4%E4%BF%83%E9%94%80%E7%AD%96%E7%95%A5%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)

下图表示strategy模块的一系列状态
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/wulinyang/doc/graph/%E7%8A%B6%E6%80%81%E5%9B%BE/%E4%BF%83%E9%94%80%E7%AD%96%E7%95%A5%E7%8A%B6%E6%80%81%E5%9B%BE.png)

### 4.1.11 userbl模块
(1)模块描述<br>
userbl模块承担的需求参见需求规格说明文档功能需求及相关非功能需求<br>
userbl模块的职责及接口参见软件体系结构描述文档<br>
(2)整体结构<br>
根据体系结构设计采用分层风格，将系统分为展示层，业务逻辑层，数据层。每一层之间为了灵活性，添加了接口，以实现针对接口编程，隔离数据传输的职责，降低层与层之间耦合，添加了businesslogicservice.userblservice.UserBLService接口。为了隔离业务逻辑职责和逻辑控制职责，我们添加了UserController，这样UserController将会实现界面层相关的业务逻辑职责。User是用户管理的领域模型对象。UserPO是作为管理信息的持久化对象添加入设计模型的。

userbl模块的设计如下图
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/wulinyang/doc/graph/userbl%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1.png)
<br>userbl模块的各个类的职责如下表所示

|模块|职责|
|---|---|
|User|用户管理的领域模型对象，负责管理用户信息方面的功能|
|UserController|负责实现用户管理界面所需要的方法|

(3)接口规范
<br>UserController的接口规范如下表
#### 供接口
||语法|前置条件|后置条件|
|---|
|UserController.login|public boolean userlogin(String id,String password);|id,password!=null|登录系统用户|
|UserController.logout|public boolean userlogout(String id);|id!=null|登出当前系统用户|
|UserController.add|public boolean addUser(int type,String id,String password) ;|id,password!=null|系统管理员新增系统用户|
|UserController.remove|public boolean removeUser(String id);|id!=null|系统管理员删除系统用户|
|UserController.modify|public boolean modifyUser(UserVO obj);|obj!=null|系统管理员修改系统用户|
|UserController.showUsers|public ArrayList&lt;UserVO> showUsers(String Info);|obj!=null|获取用户列表|
|UserController.showUser|public UserVO showUser(String id);|obj!=null|根据id获取系统用户信息|


#### 3.2 需接口
|服务名|服务|
|---|---|
|User.login(String id,String password)|登录系统用户|
|User.logout(String id)|登出当前系统用户|
|User.add(String id,String password)|系统管理员新增系统用户|
|User.remove(String id)|系统管理员删除系统用户|
|User.modify(UserVO obj)|系统管理员修改系统用户|
<br>User的接口规范如下表
#### 3.1 供接口
||语法|前置条件|后置条件|
|---|
|User.login|public boolean login(String id,String password);|id,password!=null|登录系统用户|
|User.logout|public boolean logout(String id);|id!=null|登出当前系统用户|
|User.add|public boolean add(int type,String id,String password);|id,password!=null|系统管理员新增系统用户|
|User.remove|public boolean remove(String id);|id!=null|系统管理员删除系统用户|
|User.modify|public boolean modify(UserVO obj);|obj!=null|系统管理员修改系统用户|
|User.showUser|public UserVO showUser(String id);|存在id对应的用户|返回id对应用户的详细信息|
|UserInfo.getUserLevel|public string getUserLevel(string id);|id!=null且user存在|返回该用户的权限等级|
|UserInfo.showUsers|public ArrayList&lt;UserVO> showUsers(String Info)|根据info模糊查找用户列表|

#### 3.2 需接口
|服务名|服务|
|---|---|
|UserDataService.insert(UserPO User)|插入新的单一持久化对象|
|UserDataService.update(UserPO User)|删除单一持久化对象|
|UserDataService.delete(UserPO User)|更新单一持久化对象|
|UserDataService.finds(String info)|查找多个持久化对象|
|UserDataService.find(String id)|查找单一持久化对象|


（4）userbl模块的动态模型<br>
登入用户的顺序图如下<br>
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/wulinyang/doc/graph/%E7%B1%BB%E9%A1%BA%E5%BA%8F%E5%9B%BE/%E7%99%BB%E5%85%A5%E7%94%A8%E6%88%B7%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)
新增用户的顺序图如下<br>
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/wulinyang/doc/graph/%E7%B1%BB%E9%A1%BA%E5%BA%8F%E5%9B%BE/%E5%A2%9E%E5%8A%A0%E7%94%A8%E6%88%B7%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)
修改用户的顺序图如下<br>
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/wulinyang/doc/graph/%E7%B1%BB%E9%A1%BA%E5%BA%8F%E5%9B%BE/%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%9B%BE%20.png)
删除用户的顺序图如下<br>
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/wulinyang/doc/graph/%E7%B1%BB%E9%A1%BA%E5%BA%8F%E5%9B%BE/%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)

下图表示user模块的一系列状态
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/wulinyang/doc/graph/%E7%8A%B6%E6%80%81%E5%9B%BE/%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97%E7%8A%B6%E6%80%81%E5%9B%BE.png)

### 4.1.12 chat模块
(1)模块描述<br>
chat模块承担单据审批状态变更提醒等消息提醒需求以及内部交流的需求

chat模块的职责及接口参见软件体系结构描述文档<br>
(2)整体结构<br>
根据体系结构设计采用分层风格，将系统分为展示层，业务逻辑层，数据层。展示层负责展示通信界面以及消息提示界面。业务逻辑层分为两部分，一部分是业务逻辑，负责处理消息的保存，另一部分是chat服务器，用于处理消息的产生、传输。数据层则负责对未读消息进行持久化。

chat模块的设计如下图
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/bl%E5%B1%82%E5%88%86%E8%A7%A3/chat%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1.png)

<br>chat模块的各个类的职责如下表所示

|模块|职责|
|---|---|
|Chat|负责客户端消息的保存以及客户端的注销|
|ChatServer|负责消息的产生与推送|

(3)接口规范
<br>Chat的接口规范如下表
#### 供接口
||语法|前置条件|后置条件|
|---|
|Chat.remove|public void remove(String name);|name不为空|注销客户端清空消息|
|Chat.uploadTempMsg|public void uploadTempMsg(String name, ArrayList&lt;String> msgs);|name不为空，msgs不为空|从数据库中读取存储的离线消息|

#### 需接口
|服务名|服务|
|---|---|
|ChatServer.removeClient(String name)|注销客户端|
|ChatDataService.saveMsg(String userName, String msg)|储存该用户离线消息|

<br>ChatServer的接口规范如下表
#### 供接口
||语法|前置条件|后置条件|
|---|
|ChatServer.removeClient|public void removeClient(String name)|name!=null且处于连接状态|注销客户端|
|ChatServer.sendMsg|public void sendMsg(String name,String msg)|name!=null且msg!=null|发送消息|

#### 需接口
|服务名|服务|
|---|---|
|ChatDataService.saveMsg(String userName, String msg)|储存该用户离线消息|
|ChatDataService.readMsg(String userName)|读取该用户消息|

（4）chat模块的动态模型<br>
chat模块顺序图如下
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/%E7%B1%BB%E9%A1%BA%E5%BA%8F%E5%9B%BE/chat%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)
### 4.1.13 log模块
(1)模块描述<br>
log模块承担将系统主要操作进行日志记录以及查看日志的需求

log模块的职责及接口参见软件体系结构描述文档<br>
(2)整体结构<br>
根据体系结构设计采用分层风格，将系统分为展示层，业务逻辑层，数据层。每一层之间为了灵活性，添加了接口，以实现针对接口编程，隔离数据传输的职责，降低层与层之间耦合，添加了businesslogicservice.logblservice.LogblService接口。Log是该接口的实现。

log模块的设计如下图
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/bl%E5%B1%82%E5%88%86%E8%A7%A3/log%E6%A8%A1%E5%9D%97%E5%88%86%E8%A7%A3.png)

<br>log模块的各个类的职责如下表所示

|模块|职责|
|---|---|
|Log|负责日志的记录与读取|

(3)接口规范
<br>Log的接口规范如下表
####  供接口
||语法|前置条件|后置条件|
|---|
|Log.saveLog|public boolean saveLog(String userId,String content);|userId!=null|存储该用户日志|
|Log.readLog|public String readLog(String userId);|userId!=null|读取该用户日志|

####  需接口
|服务名|服务|
|---|---|
|LogDataService.saveLog(String userId,String content)|存储该用户日志到txt中|
|LogDataService.readLog(String userId)|从txt中读取该用户日志|
|UserDataService.find(String id)|查找单一持久化对象|

（4）log模块的动态模型<br>
记录日志顺序图如下
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/%E7%B1%BB%E9%A1%BA%E5%BA%8F%E5%9B%BE/log%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)
## 4.2 数据层的分解
### 4.2.1 StockData模块

(1)模块描述<br>

此模块响应来自stockbl的服务请求

(2)整体结构<br>

StockData模块类图如下所示
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/master/doc/graph/data%E5%88%86%E8%A7%A3/stockdata.png)

StockData模块各个类职责如下

|类|职责|
|---|
|StockDataServiceImpl|把来自stockbl的服务请求委托给以下3个类|
|StockDataHelper|负责管理单据信息|
|GoodsDataHelper|负责管理商品信息|
|ClassDataHelper|负责管理商品分类信息|

(3)接口规范

|提供者|语法|功能|
|---|
|StockDataHelper|public ArrayList&lt;ReceiptPO> readReceipt(int type)|查找某个类型的单据|
|StockDataHelper|public ArrayList&lt;ReceiptPO> readReceipt()|查找全部单据|
|StockDataHelper|public ReceiptPO readReceipt(String id)|读取单个单据信息|
|StockDataHelper|public boolean writeReceipt(ReceiptPO obj)|写入单据信息|
|StockDataHelper|public boolean modifyReceipt(ReceiptPO obj)|修改单据信息（总经理使用）|
|StockDataHelper|public boolean addDraft(ReceiptPO obj,String userId)|保存单据草稿|
|StockDataHelper|public boolean delDraft(String draftId,String userId)|删除单据草稿|
|StockDataHelper|public boolean modifyDraft(ReceiptPO obj,String userId)|修改单据草稿|
|StockDataHelper|public ReceiptPO readDraft(String draftId,String userId)|根据id读取草稿|
|StockDataHelper|public ArrayList&lt;ReceiptPO>readDraft(String userId)|读取所有草稿|
|GoodsDataHelper|public boolean addGoods(GoodsPO obj)|添加商品信息|
|GoodsDataHelper|public boolean delGoods(String id)|删除商品信息|
|GoodsDataHelper|public boolean modifyGoods(GoodsPO obj)|修改商品信息|
|GoodsDataHelper|public GoodsPO getGoods(String id)|根据id查找商品并返回一个商品VO|
|GoodsDataHelper|public ArrayList&lt;GoodsPO> getGoods()|返回商品列表|
|ClassDataHelper|public boolean addClass(ClassPO obj)|新增商品分类信息|
|ClassDataHelper|public boolean delClass(String id)|删除商品分类信息|
|ClassDataHelper|public boolean modifyClass(ClassPO obj)|修改商品分类信息|
|ClassDataHelper|public ArrayList&lt;ClassVO> showClass()|返回一个记录有商品分类信息的列表|
|ClassDataHelper|public ArrayList&lt;ClassPO>showClass(String fatherId)|返回父类id匹配的商品分类信息列表|
|ClassDataHelper|public ClassPO show(String id)|根据id返回商品分类信息|

(4)相关数据格式

客户信息、商品信息、商品分类信息、单据信息序列化后保存在SQLite表里，格式如下

receipts表格

(id text,type int,obj Blob)

draft表格

(userId text,draftId text,obj Blob)

clients表格

(id text,obj Blob)

goods表格

(id text,name text,obj Blob)

classes表格

(id text,fatherId text,obj Blob)

### 4.2.2 ClientData模块

(1)模块描述

此模块响应来自clientbl的服务请求

(2)结构描述

ClientData模块类图如下所示
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/master/doc/graph/data%E5%88%86%E8%A7%A3/clientdata.png)

ClientData模块各个类职责如下

|类|职责|
|---|
|ClientDataServiceImpl|管理客户信息|

(3)供接口规范

|提供者|语法|功能|
|---|
|ClientDataServiceImpl|public boolean addClient(ClientPO obj)|新增客户信息|
|ClientDataServiceImpl|public boolean delClient(String id)|删除客户信息|
|ClientDataServiceImpl|public boolean modifyClient(ClientPO obj)|修改客户信息|
|ClientDataServiceImpl|public ClientPO showClient(String id)|返回相应的客户信息|
|ClientDataServiceImpl|public ArrayList&lt;ClientPO> show()|返回客户信息列表|


### 4.2.3 accountdata模块  

（1）模块描述  

accountdata模块实现accountdataservice的接口，提供对银行账户数据的操作服务。

（2）结构描述

accountdata模块的类图如下:  
![]()

(3)供接口规范

|接口名|语法|功能描述|
|--|--|
|AccountData.add|public boolean add(AccountPO account)|向txt文件中增加一个银行账户的信息，成功返回true|
|AccountData.delete|public boolean delete(AccountPO account)|在txt文件中删除一个账户的信息，成功返回true|
|AccountData.update|public boolean updateAccount(AccountPO account)|更新该用户名用户的其他信息，成功返回true|
|AccountData.update|public boolean updateBalance(String accountId,double newBalance)|更新该用户的余额，成功返回true|
|AccountData.findById|public AccountPO findById(String id)|根据id名查找一个用户，返回AccountPO对象|
|AccountData.findByNickname|public AccountPO findByNickname(String nickname)|根据nickname名查找一个用户，返回AccountPO对象|
|AccountData.show|public ArrayList&lt;AccountPO> showAll()|返回银行账户列表|

### 4.2.4 strategyData模块

(1)模块描述<br>
strategyData模块承担的需求参见需求规格说明文档功能需求及相关非功能需求<br>
strategyData模块的职责及接口参见软件体系结构描述文档<br>
(2)整体结构<br>
strategyData模块的类图如下
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/master/doc/graph/data%E5%88%86%E8%A7%A3/StrategyData.png)
<br>strategyData模块的各个类的职责如下表所示

|模块|职责|
|---|---|
|StrategyDataServiceImpl|strategyData模块的领域对象，负责处理StrategyData的数据调用和存储|
|ClientDiscountStrategy|客户折扣促销策略的形式化对象|
|ClientCouponStrategy|客户代金券促销策略的形式化对象|
|ClientGiftStrategy|客户赠品促销策略的形式化对象|
|bargainPackageStrategy|特价包促销策略的形式化对象|
|discountStrategy|总价折扣促销策略的形式化对象|
|giftStrategy|总价赠品促销策略的形式化对象|

(3)接口规范

|||提供的服务（供接口）|
|--|--|
|StrategyDataService.insert|语法|public boolean insert(StrategyPO strategy)|
||前置条件|数据库中不存在同样的促销策略|
||后置条件|在数据库中增加一个po|
|StrategyDataService.update|语法|public boolean update(StrategyPO strategy)|
||前置条件|数据库中存在相同id的po|
||后置条件|更新一个po|
|StrategyDataService.delete|语法|public boolean delete(StrategyPO strategy)|
||前置条件|数据库中存在同样的po|
||后置条件|删除一个po|
|StrategyDataService.find|语法|public ArrayList&lt;StrategyPO> find(String id)|
||前置条件|无|
||后置条件|根据id进行查找和返回一个po|
|StrategyDataService.finds|语法|public  ArrayList&lt;StrategyPO> finds()|
||前置条件|无|
||后置条件|返回一个促销策略列表|


### 4.2.5 userData模块
(1)模块描述<br>
strategyData模块承担的需求参见需求规格说明文档功能需求及相关非功能需求<br>
strategyData模块的职责及接口参见软件体系结构描述文档<br>
(2)整体结构<br>
userData模块的类图如下
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/master/doc/graph/data%E5%88%86%E8%A7%A3/userData.png)
<br>userData模块的各个类的职责如下表所示

|模块|职责|
|---|---|
|UserDataServiceImpl|userData模块的领域对象，负责处理UserData的数据调用和存储|

(3)接口规范

|||提供的服务（供接口）|
|--|--|
|UserDataService.insert|语法|public boolean insert(UserPO User)|
||前置条件|数据库中不存在同样的UserPO|
||后置条件|在数据库中增加一个po|
|UserDataService.update|语法|public boolean update(UserPO User)|
||前置条件|数据库中存在相同id的po|
||后置条件|更新一个po|
|UserDataService.delete|语法|public boolean delete(UserPO User)|
||前置条件|数据库中存在同样的po|
||后置条件|删除一个po|
|UserDataService.find|语法|public UserPO find(String id)|
||前置条件|无|
||后置条件|根据id进行查找和返回一个po|
|UserDataService.finds|语法|public ArrayList&lt;UserPO> finds(String info)|
||前置条件|无|
||后置条件|返回一个UserPO列表|
|UserDataInfo.findUser|语法|public boolean findUser(String id)|
||前置条件|无|
||后置条件|若id对应的用户存在则返回true，不存在返回false|

### 4.2.6 bookdata

(1)模块概述  
bookdata模块承担的需求参见需求规格说明文档功能需求及相关非功能需求<br>
bookdata模块的职责及接口参见软件体系结构描述文档<br>

(2)模块结构<br>
bookdata模块的设计图如下:
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/data%E5%88%86%E8%A7%A3/BookData%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E5%9B%BE.png)

(3)模块内部类的接口规范
供接口

||语法|前置条件|后置条件|
|---|
|BookDataService.initBook|public boolean initBook(BookPO book)|book!=null|根据给定信息新建一套账目|
|BookDataService.saveDraft|public boolean saveDraft()|无|根据已有信息新建一套账目草稿|
|BookDataService.cancelChange|public void cancelChange()|无|取消已有更改|
|BookDataService.showBook|public BookVO showBook()|无|返回期初账目|
|BookDataService.creatingBook|public void creatingBook()|无|进入建账状态|


### 4.2.7 chatdata

(1)模块概述  
chatdata模块承担的需求参见需求规格说明文档功能需求及相关非功能需求<br>
chatdata模块的职责及接口参见软件体系结构描述文档<br>

(2)模块结构<br>
chatdata模块的设计图如下:
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/data%E5%88%86%E8%A7%A3/chatData%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E5%9B%BE.png)

(3)模块内部类的接口规范
供接口

||语法|前置条件|后置条件|
|---|
|ChatDataService.saveMsg|public boolean saveMsg(String usedName,String msg)|储存该用户离线消息|
|ChatDataService.readMsg|public ArrayList&lt;String>readMsg(String userName)|读取该用户消息|

### 4.2.8 logdata

(1)模块概述  
logdata模块承担的需求参见需求规格说明文档功能需求及相关非功能需求<br>
logdata模块的职责及接口参见软件体系结构描述文档<br>

(2)模块结构<br>
logdata模块的设计图如下:
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/Wangyibo/doc/graph/data%E5%88%86%E8%A7%A3/logData%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E5%9B%BE.png)

(3)模块内部类的接口规范
供接口

||语法|前置条件|后置条件|
|---|
|LogDataService.saveLog|public boolean saveLog(String userId,String content)|存储该用户日志到txt中|
|LogDataService.readLog|public String readLog(String userId)|从txt中读取该用户日志|

### 5 依赖视角
客户端各自包间的依赖关系如下<br>
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/wulinyang/doc/graph/%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BC%80%E5%8F%91%E5%8C%85%E5%9B%BE.png)
<br><br><br>

服务器端各自包间的依赖关系如下<br>
![](http://101.37.19.32:10080/161250103/ManageSystem/raw/wulinyang/doc/graph/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E5%BC%80%E5%8F%91%E5%8C%85%E5%9B%BE.png)
